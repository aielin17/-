<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Style Gallery</title>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
:root{
  --bg:#f4f4f8;
  --surface:#ffffff;
  --border:#e2e2e8;
  --border-strong:#c8c8d0;
  --text:#0d0d12;
  --text-sub:#888898;
  --text-muted:#b0b0bc;
  --accent:#5b5fef;
  --accent-hover:#4a4edd;
  --accent-bg:rgba(91,95,239,.08);
  --accent-bg2:rgba(91,95,239,.15);
  --fav:#ef4444;
  --fav-bg:rgba(239,68,68,.08);
  --radius:16px;
  --radius-sm:10px;
  --sidebar:240px;
  --hh:58px;
  --shadow-sm:0 1px 3px rgba(0,0,0,.06),0 1px 2px rgba(0,0,0,.04);
  --shadow:0 4px 16px rgba(0,0,0,.08),0 1px 4px rgba(0,0,0,.04);
  --shadow-lg:0 12px 40px rgba(0,0,0,.14),0 4px 12px rgba(0,0,0,.06);
}
@font-face{font-family:'F1';src:url('https://files.catbox.moe/kmyipl.TTF') format('truetype');font-display:swap}
@font-face{font-family:'F2';src:url('https://image.uglycat.cc/6wapca.ttf') format('truetype');font-display:swap}
@font-face{font-family:'F3';src:url('https://files.catbox.moe/3bm8wp.ttf') format('truetype');font-display:swap}
@font-face{font-family:'F4';src:url('https://files.catbox.moe/caatu4.TTF') format('truetype');font-display:swap}

html{height:100%}
body{
  font-family:-apple-system,"SF Pro Text","PingFang SC","Helvetica Neue",sans-serif;
  background:var(--bg);color:var(--text);
  height:100dvh;display:flex;flex-direction:column;overflow:hidden;line-height:1.5;
}

/* â”€â”€â”€ Header â”€â”€â”€ */
.header{
  height:var(--hh);background:rgba(255,255,255,.92);border-bottom:1px solid var(--border);
  backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);
  display:flex;align-items:center;padding:0 16px;gap:10px;flex-shrink:0;z-index:100;
  transform:translateY(-100%);animation:slideDown .4s cubic-bezier(.22,1,.36,1) .05s forwards;
}
.brand{font-weight:800;font-size:16px;letter-spacing:-.5px;display:flex;align-items:center;gap:7px;flex-shrink:0;color:var(--text)}
.brand-icon{width:28px;height:28px;background:linear-gradient(135deg,#5b5fef,#a855f7);border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.brand-icon svg{width:15px;height:15px;color:#fff}

.search-wrap{flex:1;max-width:320px;position:relative}
.search-wrap svg{position:absolute;left:10px;top:50%;transform:translateY(-50%);width:14px;height:14px;color:var(--text-muted);pointer-events:none}
.search-input{
  width:100%;padding:8px 12px 8px 32px;border:1.5px solid var(--border);border-radius:10px;
  font-size:13.5px;background:#f6f6fa;font-family:inherit;transition:all .18s;color:var(--text);
}
.search-input::placeholder{color:var(--text-muted)}
.search-input:focus{border-color:var(--accent);background:#fff;box-shadow:0 0 0 3px var(--accent-bg);outline:none}

.header-nav{display:flex;gap:2px;background:#eeeef4;padding:3px;border-radius:10px;margin-left:auto;flex-shrink:0}
.nav-btn{
  cursor:pointer;font-size:12.5px;font-weight:600;color:var(--text-sub);
  padding:5px 14px;border-radius:7px;transition:all .15s;user-select:none;white-space:nowrap;
}
.nav-btn.active{background:#fff;color:var(--text);box-shadow:var(--shadow-sm)}
.nav-btn:hover:not(.active){color:var(--text)}

/* â”€â”€â”€ Layout â”€â”€â”€ */
.workspace{flex:1;display:flex;overflow:hidden;opacity:0;animation:fadeIn .35s ease .25s forwards}

.sidebar{
  width:var(--sidebar);flex-shrink:0;background:var(--surface);border-right:1px solid var(--border);
  display:flex;flex-direction:column;overflow:hidden;transition:width .3s cubic-bezier(.22,1,.36,1);
}
.sidebar.hidden{width:0}
.sidebar-inner{flex:1;overflow-y:auto;overflow-x:hidden;padding:16px 12px;display:flex;flex-direction:column;gap:22px}
.sidebar-inner::-webkit-scrollbar{width:3px}
.sidebar-inner::-webkit-scrollbar-thumb{background:#ddd;border-radius:4px}

.s-label{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.9px;color:var(--text-muted);margin-bottom:9px;padding:0 4px}
.type-list,.author-list{display:flex;flex-direction:column;gap:2px}
.type-pill{
  padding:8px 10px;border-radius:10px;font-size:13px;font-weight:500;cursor:pointer;
  transition:all .15s;color:var(--text-sub);display:flex;align-items:center;gap:9px;user-select:none;
}
.type-pill:hover{background:#f4f4f8;color:var(--text)}
.type-pill.active{background:var(--accent-bg);color:var(--accent);font-weight:700}
.type-pill.fav-pill.active{background:var(--fav-bg);color:var(--fav)}
.type-pill svg{width:14px;height:14px;flex-shrink:0;opacity:.7}
.type-pill.active svg{opacity:1}
.pill-count{margin-left:auto;font-size:10px;font-weight:700;background:rgba(0,0,0,.06);padding:1px 7px;border-radius:20px;color:var(--text-muted)}
.type-pill.active .pill-count{background:var(--accent-bg2);color:var(--accent)}
.type-pill.fav-pill.active .pill-count{background:rgba(239,68,68,.15);color:var(--fav)}

.author-chip{
  padding:6px 10px;border-radius:8px;font-size:12.5px;cursor:pointer;transition:.15s;
  color:var(--text-sub);user-select:none;display:flex;align-items:center;justify-content:space-between;
}
.author-chip:hover{background:#f4f4f8;color:var(--text)}
.author-chip.active{background:var(--accent-bg);color:var(--accent);font-weight:600}
.author-chip-n{font-size:10.5px;opacity:.55}

.main{flex:1;display:flex;flex-direction:column;overflow:hidden;min-width:0}

.toolbar{
  padding:10px 16px;border-bottom:1px solid var(--border);background:var(--surface);
  display:flex;align-items:center;gap:10px;flex-shrink:0;
}
.toolbar-info{font-size:12px;color:var(--text-sub);font-weight:500}
.mobile-filter-btn{
  display:none;align-items:center;gap:5px;font-size:12px;font-weight:600;color:var(--accent);
  padding:5px 10px;border-radius:8px;background:var(--accent-bg);cursor:pointer;user-select:none;flex-shrink:0;
}
.mobile-filter-btn svg{width:13px;height:13px}

.card-area{flex:1;overflow-y:auto;padding:16px}
.card-area::-webkit-scrollbar{width:4px}
.card-area::-webkit-scrollbar-thumb{background:#ddd;border-radius:4px}
.card-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px}

/* â”€â”€â”€ Cards â”€â”€â”€ */
.item-card{
  background:var(--surface);border:1.5px solid var(--border);border-radius:var(--radius);
  padding:14px 15px;cursor:pointer;transition:all .18s cubic-bezier(.25,.46,.45,.94);
  display:flex;flex-direction:column;gap:10px;
  opacity:0;transform:translateY(10px);animation:cardIn .3s cubic-bezier(.22,1,.36,1) forwards;
  position:relative;overflow:hidden;
}
.item-card::before{
  content:'';position:absolute;inset:0;border-radius:var(--radius);
  background:linear-gradient(135deg,transparent 60%,rgba(91,95,239,.03));pointer-events:none;
}
.item-card:hover{border-color:var(--border-strong);box-shadow:var(--shadow);transform:translateY(-2px)}
.item-card.active{border-color:var(--accent);box-shadow:0 0 0 2px var(--accent-bg2),var(--shadow)}
.item-card.favorited{border-color:rgba(239,68,68,.25)}

.card-top{display:flex;align-items:flex-start;justify-content:space-between;gap:8px}
.card-name{font-size:14px;font-weight:700;line-height:1.3;color:var(--text)}
.card-badge{
  font-size:9.5px;font-weight:800;padding:2px 7px;border-radius:5px;flex-shrink:0;
  margin-top:2px;text-transform:uppercase;letter-spacing:.3px;
}
.badge-bubble{background:#e8f0ff;color:#3478f6}
.badge-font{background:#f0eaff;color:#8b5cf6}

.card-author{font-size:11.5px;color:var(--text-sub);background:#f4f4f8;padding:3px 8px;border-radius:6px;width:fit-content}

.card-actions{display:flex;gap:6px;justify-content:flex-end;align-items:center;margin-top:2px}
.btn-preview{
  height:30px;padding:0 11px;border:1.5px solid var(--border);background:#fff;border-radius:8px;
  display:flex;align-items:center;gap:5px;cursor:pointer;transition:.15s;color:var(--text-sub);font-size:11.5px;font-weight:600;
  font-family:inherit;
}
.btn-preview:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg)}
.btn-preview svg{width:12px;height:12px}
.btn-icon{
  width:30px;height:30px;border:1.5px solid var(--border);background:#fff;border-radius:8px;
  display:flex;align-items:center;justify-content:center;cursor:pointer;transition:.15s;color:var(--text-sub);flex-shrink:0;
}
.btn-icon:hover{border-color:var(--border-strong);color:var(--text);background:#f4f4f8}
.btn-icon:active{transform:scale(.92)}
.btn-icon svg{width:12.5px;height:12.5px;stroke-width:2.5}
.btn-fav{border:1.5px solid transparent;background:transparent;}
.btn-fav:hover{border-color:var(--fav)!important;color:var(--fav)!important;background:var(--fav-bg)!important}
.btn-fav.on{color:var(--fav)!important;border-color:rgba(239,68,68,.3)!important;background:var(--fav-bg)!important}
.btn-fav svg{width:13px;height:13px;stroke-width:2}

.empty-state{grid-column:1/-1;text-align:center;padding:60px 20px;color:var(--text-muted);font-size:14px}
.empty-state svg{width:40px;height:40px;margin:0 auto 14px;display:block;opacity:.25}

/* â”€â”€â”€ Preview Modal â”€â”€â”€ */
.modal-backdrop{
  position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:500;
  display:flex;align-items:flex-end;justify-content:center;
  opacity:0;pointer-events:none;transition:opacity .25s ease;
  -webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);
}
.modal-backdrop.open{opacity:1;pointer-events:all}

.modal{
  background:var(--surface);border-radius:24px 24px 0 0;width:100%;max-width:600px;
  display:flex;flex-direction:column;overflow:hidden;
  transform:translateY(100%);transition:transform .32s cubic-bezier(.22,1,.36,1);
  max-height:88dvh;
  box-shadow:0 -8px 40px rgba(0,0,0,.18);
}
.modal-backdrop.open .modal{transform:translateY(0)}

@media(min-width:640px){
  .modal-backdrop{align-items:center;padding:20px}
  .modal{border-radius:24px;max-height:85dvh;transform:scale(.92) translateY(20px);max-width:560px}
  .modal-backdrop.open .modal{transform:scale(1) translateY(0)}
}

.modal-handle{width:36px;height:4px;background:var(--border-strong);border-radius:2px;margin:12px auto 0;flex-shrink:0}
.modal-header{padding:14px 20px 12px;display:flex;align-items:center;justify-content:space-between;flex-shrink:0;border-bottom:1px solid var(--border)}
.modal-title-area{display:flex;align-items:center;gap:10px}
.modal-name{font-size:16px;font-weight:700;color:var(--text)}
.modal-header-actions{display:flex;align-items:center;gap:6px}
.modal-fav-btn{
  width:30px;height:30px;border:1.5px solid transparent;background:transparent;border-radius:50%;
  display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--text-muted);transition:.15s;
}
.modal-fav-btn:hover{color:var(--fav);background:var(--fav-bg)}
.modal-fav-btn.on{color:var(--fav);background:var(--fav-bg)}
.modal-fav-btn svg{width:15px;height:15px;stroke-width:2}
.modal-close{
  width:30px;height:30px;border:none;background:#f0f0f5;border-radius:50%;display:flex;
  align-items:center;justify-content:center;cursor:pointer;color:var(--text-sub);transition:.15s;flex-shrink:0;
}
.modal-close:hover{background:#e4e4ea;color:var(--text)}
.modal-close svg{width:14px;height:14px;stroke-width:2.5}

.modal-body{flex:1;overflow-y:auto;padding:18px 20px;background:#f9f9fc;display:flex;flex-direction:column;gap:10px}
.modal-body::-webkit-scrollbar{width:3px}
.modal-body::-webkit-scrollbar-thumb{background:#ddd;border-radius:4px}

.msg-row{display:flex;width:100%}
.msg-row.sent{justify-content:flex-end}
.msg-row.received{justify-content:flex-start}
.message{max-width:76%;font-size:15px;padding:9px 14px;background:#e5e5ea;border-radius:18px;word-break:break-word;line-height:1.45}
.message-sent{background:var(--accent);color:#fff}

.font-preview-box{background:#fff;border-radius:var(--radius);padding:24px;text-align:center;border:1px solid var(--border)}
.font-big{font-size:32px;color:var(--text);margin-bottom:10px;line-height:1.3}
.font-small{font-size:14px;color:var(--text-sub);line-height:2}
.font-chars{font-size:18px;color:var(--text-muted);margin-top:10px;letter-spacing:.5px}

/* â”€â”€â”€ Modal Footer / Font switcher â”€â”€â”€ */
.modal-footer{
  padding:12px 20px 20px;border-top:1px solid var(--border);background:var(--surface);
  display:flex;flex-direction:column;gap:10px;flex-shrink:0;
}
.font-cat-section{display:flex;flex-direction:column;gap:5px}
.font-cat-header{display:flex;align-items:center;gap:7px}
.font-switch-label{font-size:10px;font-weight:700;color:var(--text-muted);text-transform:uppercase;letter-spacing:.5px}
.font-cat-name{font-size:10px;font-weight:700;color:var(--text-muted);background:#f0f0f5;padding:2px 7px;border-radius:4px;letter-spacing:.3px}
.modal-footer-row{display:flex;gap:6px;flex-wrap:wrap}
.font-btn{
  font-size:12px;padding:5px 12px;border:1.5px solid var(--border);border-radius:8px;cursor:pointer;
  background:#f6f6fa;transition:.15s;color:var(--text-sub);font-weight:600;font-family:inherit;
}
.font-btn:hover{border-color:var(--border-strong);color:var(--text)}
.font-btn.active{border-color:var(--accent);color:var(--accent);background:var(--accent-bg)}
.copy-css-btn{
  width:100%;padding:12px;background:var(--accent);color:#fff;border:none;border-radius:11px;
  font-size:14px;font-weight:700;cursor:pointer;transition:background .15s;font-family:inherit;
  display:flex;align-items:center;justify-content:center;gap:7px;
}
.copy-css-btn:hover{background:var(--accent-hover)}
.copy-css-btn:active{transform:scale(.98)}
.copy-css-btn svg{width:15px;height:15px}

/* â”€â”€â”€ Variant Group Switcher â”€â”€â”€ */
.variant-section{display:flex;flex-direction:column;gap:5px;padding-bottom:2px}
.variant-label{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:var(--text-muted);display:flex;align-items:center;gap:6px}
.variant-tag{font-size:10px;font-weight:700;background:#f0eaff;color:#8b5cf6;padding:1px 7px;border-radius:4px}
.variant-row{display:flex;gap:6px;flex-wrap:wrap}
.variant-btn{
  font-size:12px;padding:5px 12px;border:1.5px solid var(--border);border-radius:8px;cursor:pointer;
  background:#f6f6fa;transition:.15s;color:var(--text-sub);font-weight:600;font-family:inherit;
}
.variant-btn:hover{border-color:var(--border-strong);color:var(--text)}
.variant-btn.active{border-color:#8b5cf6;color:#8b5cf6;background:#f0eaff}
.card-group-dot{display:inline-block;width:7px;height:7px;border-radius:50%;background:#8b5cf6;margin-left:4px;vertical-align:middle;flex-shrink:0;}

/* â”€â”€â”€ Card Variant Picker â”€â”€â”€ */
.card-variants{display:flex;gap:4px;flex-wrap:wrap;margin-top:2px}
.card-var-btn{
  font-size:10.5px;padding:3px 8px;border:1.5px solid var(--border);border-radius:6px;cursor:pointer;
  background:#f6f6fa;transition:.15s;color:var(--text-sub);font-weight:600;font-family:inherit;
}
.card-var-btn:hover{border-color:var(--border-strong);color:var(--text)}
.card-var-btn.active{border-color:#8b5cf6;color:#8b5cf6;background:#f0eaff}

/* â”€â”€â”€ Mobile Filter Drawer (FIX: pointer-events) â”€â”€â”€ */
.filter-drawer{
  position:fixed;inset:0;z-index:400;pointer-events:none;
}
.filter-drawer-bg{
  position:absolute;inset:0;background:rgba(0,0,0,.4);
  opacity:0;transition:opacity .25s;pointer-events:none;
  -webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);
}
.filter-drawer.open .filter-drawer-bg{opacity:1;pointer-events:all}
.filter-drawer-panel{
  position:absolute;left:0;top:0;bottom:0;width:min(280px,80vw);background:var(--surface);
  transform:translateX(-100%);transition:transform .3s cubic-bezier(.22,1,.36,1);
  overflow-y:auto;padding:24px 16px;display:flex;flex-direction:column;gap:22px;
  box-shadow:var(--shadow-lg);pointer-events:none; /* closed: no events */
}
/* FIX: open panel gets pointer events */
.filter-drawer.open .filter-drawer-panel{transform:translateX(0);pointer-events:all}

/* â”€â”€â”€ Submit View â”€â”€â”€ */
.submit-view{
  display:none;flex:1;overflow-y:auto;background:var(--bg);
  padding:32px 16px 48px;align-items:flex-start;justify-content:center;
}
.submit-view.active{display:flex}
.submit-card{width:100%;max-width:540px;background:var(--surface);border-radius:24px;padding:32px 28px;box-shadow:var(--shadow)}
.s-header{text-align:center;margin-bottom:28px}
.s-header h2{font-size:22px;font-weight:800;margin-bottom:6px;letter-spacing:-.4px}
.s-header p{color:var(--text-sub);font-size:13px}
.s-type-row{display:flex;gap:8px;margin-bottom:28px}
.s-type-btn{
  flex:1;padding:10px;border:2px solid var(--border);background:transparent;border-radius:12px;
  font-weight:700;font-size:13.5px;color:var(--text-sub);cursor:pointer;transition:.18s;font-family:inherit;
}
.s-type-btn.active{border-color:var(--accent);color:var(--accent);background:var(--accent-bg)}
.form-panel{display:none;animation:fadeIn .22s ease}
.form-panel.active{display:block}
.fg{margin-bottom:18px}
.fl{display:block;margin-bottom:5px;font-weight:700;font-size:13px;color:#333}
.fl-sub{display:block;margin-bottom:7px;font-size:11px;color:#aaa;margin-top:-2px}
.fi,.fta{
  width:100%;padding:11px 13px;border:1.5px solid var(--border);border-radius:11px;
  font-size:14px;background:#f8f8fc;transition:all .18s;font-family:inherit;color:var(--text);
}
.fta{height:140px;font-family:'Menlo','Monaco',monospace;font-size:12px;line-height:1.5;resize:vertical}
.fi:focus,.fta:focus{border-color:var(--accent);background:#fff;box-shadow:0 0 0 3px var(--accent-bg);outline:none}
.preview-inputs{display:flex;flex-direction:column;gap:7px;background:#f4f4f8;padding:12px;border-radius:12px}
.pi-row{display:flex;align-items:center;gap:8px}
.pi-tag{font-size:10px;font-weight:700;color:var(--text-muted);width:28px;text-align:right;flex-shrink:0}
.pi-row .fi{background:#fff}
.submit-btn{
  background:var(--accent);color:#fff;border:none;padding:13px;border-radius:12px;
  font-weight:700;font-size:15px;cursor:pointer;width:100%;transition:background .15s;
  display:flex;align-items:center;justify-content:center;gap:8px;font-family:inherit;margin-bottom:10px;
}
.submit-btn:hover{background:var(--accent-hover)}
.submit-btn:active{transform:scale(.98)}

/* â”€â”€â”€ Submit Fallback Panel â”€â”€â”€ */
.fallback-panel{
  display:none;background:#f8f8fc;border:1.5px solid var(--border);border-radius:14px;
  padding:18px;margin-top:4px;
}
.fallback-panel.show{display:block}
.fallback-title{font-size:13px;font-weight:700;color:var(--text);margin-bottom:4px;display:flex;align-items:center;gap:6px}
.fallback-desc{font-size:12px;color:var(--text-sub);margin-bottom:12px;line-height:1.5}
.fallback-to{
  font-size:12px;background:#fff;border:1.5px solid var(--border);border-radius:9px;
  padding:8px 12px;margin-bottom:8px;display:flex;align-items:center;justify-content:space-between;gap:8px;
}
.fallback-to strong{color:var(--accent);font-weight:700;word-break:break-all}
.fallback-code{
  width:100%;font-family:'Menlo','Monaco',monospace;font-size:11px;line-height:1.6;
  background:#fff;border:1.5px solid var(--border);border-radius:9px;
  padding:10px 12px;color:var(--text);resize:none;height:180px;
}
.fallback-code:focus{outline:none;border-color:var(--accent)}
.fallback-btns{display:flex;gap:8px;margin-top:10px}
.fb-btn{
  flex:1;padding:10px;border:1.5px solid var(--border);background:#fff;border-radius:10px;
  font-size:12.5px;font-weight:700;cursor:pointer;transition:.15s;font-family:inherit;color:var(--text-sub);
  display:flex;align-items:center;justify-content:center;gap:5px;
}
.fb-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg)}
.fb-btn svg{width:12px;height:12px}

/* â”€â”€â”€ Toast â”€â”€â”€ */
#toast{
  position:fixed;z-index:9999;left:50%;bottom:28px;transform:translateX(-50%) translateY(12px);
  background:rgba(15,15,20,.9);color:#fff;text-align:center;border-radius:50px;
  padding:10px 22px;font-size:13px;font-weight:500;
  box-shadow:0 6px 24px rgba(0,0,0,.25);backdrop-filter:blur(12px);
  opacity:0;pointer-events:none;transition:opacity .2s,transform .2s;white-space:nowrap;
}
#toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

@keyframes slideDown{to{transform:translateY(0)}}
@keyframes fadeIn{to{opacity:1}}
@keyframes cardIn{to{opacity:1;transform:translateY(0)}}

@media(max-width:768px){
  .sidebar{display:none}
  .mobile-filter-btn{display:flex}
  .card-grid{grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:8px}
  .submit-card{padding:24px 18px}
}
@media(max-width:380px){
  .card-grid{grid-template-columns:1fr 1fr}
  :root{--hh:52px}
  .search-wrap{max-width:160px}
}
@media(min-width:1200px){
  .card-grid{grid-template-columns:repeat(auto-fill,minmax(220px,1fr))}
}
</style>
<style id="dbs"></style>
</head>
<body>

<header class="header">
  <div class="brand">
    <div class="brand-icon">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2">
        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
      </svg>
    </div>
    Style Gallery
  </div>
  <div class="search-wrap">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
    <input type="text" class="search-input" placeholder="æœç´¢åç§°ã€ä½œè€…â€¦" id="search-input" autocomplete="off" spellcheck="false">
  </div>
  <div class="header-nav">
    <div class="nav-btn active" data-tab="gallery">ç”»å»Š</div>
    <div class="nav-btn" data-tab="submit">æŠ•ç¨¿</div>
  </div>
</header>

<div class="workspace" id="gallery-view">

  <div class="sidebar" id="sidebar">
    <div class="sidebar-inner">
      <div>
        <div class="s-label">ç±»å‹</div>
        <div class="type-list" id="type-list">
          <div class="type-pill active" data-type="all">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
            å…¨éƒ¨ <span class="pill-count" id="c-all">0</span>
          </div>
          <div class="type-pill" data-type="bubble">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
            æ°”æ³¡ <span class="pill-count" id="c-bubble">0</span>
          </div>
          <div class="type-pill" data-type="font">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 7V4h16v3M9 20h6M12 4v16"/></svg>
            å­—ä½“ <span class="pill-count" id="c-font">0</span>
          </div>
          <div class="type-pill fav-pill" data-type="fav">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
            æ”¶è— <span class="pill-count" id="c-fav">0</span>
          </div>
        </div>
      </div>
      <div>
        <div class="s-label">ä½œè€…</div>
        <div class="author-list" id="author-list"></div>
      </div>
    </div>
  </div>

  <div class="main">
    <div class="toolbar">
      <div class="mobile-filter-btn" id="mobile-filter-btn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="4" y1="6" x2="20" y2="6"/><line x1="8" y1="12" x2="16" y2="12"/><line x1="11" y1="18" x2="13" y2="18"/></svg>
        ç­›é€‰
      </div>
      <span class="toolbar-info" id="toolbar-info">0 ä¸ªç»“æœ</span>
    </div>
    <div class="card-area">
      <div class="card-grid" id="card-grid"></div>
    </div>
  </div>

</div>

<!-- Submit View -->
<div class="submit-view" id="submit-view">
  <div class="submit-card">
    <div class="s-header">
      <h2>æäº¤ä½ çš„åˆ›æ„</h2>
      <p>é€‰æ‹©ç±»å‹ï¼Œå¡«å†™ä¿¡æ¯ï¼Œé€šè¿‡é‚®ä»¶å‘é€ç»™æˆ‘</p>
    </div>
    <div class="s-type-row">
      <button class="s-type-btn active" onclick="switchForm('bubble')">ğŸ’¬ æ°”æ³¡æŠ•ç¨¿</button>
      <button class="s-type-btn" onclick="switchForm('font')">âœ¦ å­—ä½“æŠ•ç¨¿</button>
    </div>

    <!-- Bubble Form -->
    <div class="form-panel active" id="form-bubble">
      <div class="fg"><label class="fl">æ°”æ³¡åç§°</label><input type="text" class="fi" placeholder="ç»™ä½ çš„æ°”æ³¡èµ·ä¸ªåå­—" id="bubble-name"></div>
      <div class="fg"><label class="fl">ä½œè€…ç½²å</label><input type="text" class="fi" placeholder="å±•ç¤ºç”¨çš„æ˜µç§°" id="bubble-author"></div>
      <div class="fg">
        <label class="fl">CSS ä»£ç </label>
        <span class="fl-sub">éœ€åŒ…å« .message-sent å’Œ .message-received ç±»</span>
        <textarea class="fta" id="bubble-css" placeholder=" "></textarea>
      </div>
      <div class="fg">
        <label class="fl">é¢„è§ˆå¯¹è¯ï¼ˆ2ï½4 æ¡ï¼‰</label>
        <span class="fl-sub">ç•™ç©ºåˆ™è·³è¿‡è¯¥è¡Œ</span>
        <div class="preview-inputs">
          <div class="pi-row"><span class="pi-tag">å‘é€</span><input type="text" class="fi" id="p1" placeholder="ç¬¬ä¸€æ¡æ¶ˆæ¯"></div>
          <div class="pi-row"><span class="pi-tag">æ¥æ”¶</span><input type="text" class="fi" id="p2" placeholder="ç¬¬äºŒæ¡æ¶ˆæ¯"></div>
          <div class="pi-row"><span class="pi-tag">å‘é€</span><input type="text" class="fi" id="p3" placeholder="ç¬¬ä¸‰æ¡ï¼ˆå¯é€‰ï¼‰"></div>
          <div class="pi-row"><span class="pi-tag">æ¥æ”¶</span><input type="text" class="fi" id="p4" placeholder="ç¬¬å››æ¡ï¼ˆå¯é€‰ï¼‰"></div>
        </div>
      </div>
      <button class="submit-btn" onclick="doSubmit('bubble')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
        å”¤èµ·é‚®ä»¶å®¢æˆ·ç«¯å‘é€
      </button>
      <!-- Fallback -->
      <div class="fallback-panel" id="fallback-bubble">
        <div class="fallback-title">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:14px;height:14px;color:var(--accent)"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
          æ²¡æœ‰é‚®ä»¶å®¢æˆ·ç«¯ï¼Ÿæ‰‹åŠ¨å‘é€
        </div>
        <p class="fallback-desc">å°†ä»¥ä¸‹å†…å®¹å¤åˆ¶åï¼Œé€šè¿‡ä»»æ„æ–¹å¼ï¼ˆQQ / å¾®ä¿¡ / é‚®ä»¶ç½‘é¡µç‰ˆï¼‰å‘é€ç»™æˆ‘</p>
        <div class="fallback-to">
          <span>æ”¶ä»¶åœ°å€</span>
          <strong id="fb-email-b"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="1f2c2e2a2d2f2c282d2d2b5f6e6e317c7072">[email&#160;protected]</a></strong>
        </div>
        <textarea class="fallback-code" id="fb-content-bubble" readonly></textarea>
        <div class="fallback-btns">
          <button class="fb-btn" onclick="copyFallback('bubble')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
            å¤åˆ¶æŠ•ç¨¿å†…å®¹
          </button>
          <button class="fb-btn" onclick="copyEmail('bubble')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/></svg>
            å¤åˆ¶æ”¶ä»¶åœ°å€
          </button>
        </div>
      </div>
    </div>

    <!-- Font Form -->
    <div class="form-panel" id="form-font">
      <div class="fg"><label class="fl">å­—ä½“åç§°</label><input type="text" class="fi" placeholder="å­—ä½“åç§°" id="font-name"></div>
      <div class="fg"><label class="fl">ä½œè€…ç½²å</label><input type="text" class="fi" placeholder="æ˜µç§°" id="font-author"></div>
      <div class="fg">
        <label class="fl">å­—ä½“é“¾æ¥</label>
        <span class="fl-sub">ç›´é“¾ URLï¼Œæ”¯æŒ .ttf / .otf / .woff2 ç­‰æ ¼å¼</span>
        <input type="text" class="fi" placeholder="https://example.com/font.ttf" id="font-url">
      </div>
      <div class="fg">
        <label class="fl">å­—ä½“åˆ†ç±»</label>
        <span class="fl-sub">æ–¹ä¾¿æ•´ç†å½’æ¡£</span>
        <select class="fi" id="font-category">
          <option value="æ‰‹å†™">æ‰‹å†™ä½“</option>
          <option value="è¡¬çº¿">è¡¬çº¿ä½“</option>
          <option value="æ— è¡¬çº¿">æ— è¡¬çº¿ä½“</option>
          <option value="è‰ºæœ¯">è‰ºæœ¯å­—</option>
          <option value="ç­‰å®½">ç­‰å®½ä½“</option>
          <option value="å…¶ä»–">å…¶ä»–</option>
        </select>
      </div>
      <button class="submit-btn" onclick="doSubmit('font')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
        å”¤èµ·é‚®ä»¶å®¢æˆ·ç«¯å‘é€
      </button>
      <!-- Fallback -->
      <div class="fallback-panel" id="fallback-font">
        <div class="fallback-title">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:14px;height:14px;color:var(--accent)"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
          æ²¡æœ‰é‚®ä»¶å®¢æˆ·ç«¯ï¼Ÿæ‰‹åŠ¨å‘é€
        </div>
        <p class="fallback-desc">å°†ä»¥ä¸‹å†…å®¹å¤åˆ¶åï¼Œé€šè¿‡ä»»æ„æ–¹å¼ï¼ˆQQ / å¾®ä¿¡ / é‚®ä»¶ç½‘é¡µç‰ˆï¼‰å‘é€ç»™æˆ‘</p>
        <div class="fallback-to">
          <span>æ”¶ä»¶åœ°å€</span>
          <strong id="fb-email-f"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="2f1c1e1a1d1f1c181d1d1b6f5e5e014c4042">[email&#160;protected]</a></strong>
        </div>
        <textarea class="fallback-code" id="fb-content-font" readonly></textarea>
        <div class="fallback-btns">
          <button class="fb-btn" onclick="copyFallback('font')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
            å¤åˆ¶æŠ•ç¨¿å†…å®¹
          </button>
          <button class="fb-btn" onclick="copyEmail('font')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/></svg>
            å¤åˆ¶æ”¶ä»¶åœ°å€
          </button>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- Preview Modal -->
<div class="modal-backdrop" id="modal-backdrop">
  <div class="modal" id="modal" role="dialog" aria-modal="true">
    <div class="modal-handle"></div>
    <div class="modal-header">
      <div class="modal-title-area">
        <div id="modal-badge"></div>
        <span class="modal-name" id="modal-name">é¢„è§ˆ</span>
      </div>
      <div class="modal-header-actions">
        <button class="modal-fav-btn" id="modal-fav-btn" title="æ”¶è—">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
        </button>
        <button class="modal-close" id="modal-close" aria-label="å…³é—­">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M18 6L6 18M6 6l12 12"/></svg>
        </button>
      </div>
    </div>
    <div class="modal-body" id="modal-body"></div>
    <div class="modal-footer" id="modal-footer"></div>
  </div>
</div>

<!-- Mobile Filter Drawer -->
<div class="filter-drawer" id="filter-drawer">
  <div class="filter-drawer-bg" id="filter-drawer-bg"></div>
  <div class="filter-drawer-panel">
    <div>
      <div class="s-label">ç±»å‹</div>
      <div class="type-list" id="m-type-list">
        <div class="type-pill active" data-type="all">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
          å…¨éƒ¨ <span class="pill-count" id="mc-all">0</span>
        </div>
        <div class="type-pill" data-type="bubble">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
          èŠå¤©æ°”æ³¡ <span class="pill-count" id="mc-bubble">0</span>
        </div>
        <div class="type-pill" data-type="font">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 7V4h16v3M9 20h6M12 4v16"/></svg>
          å­—ä½“ <span class="pill-count" id="mc-font">0</span>
        </div>
        <div class="type-pill fav-pill" data-type="fav">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
          æ”¶è— <span class="pill-count" id="mc-fav">0</span>
        </div>
      </div>
    </div>
    <div>
      <div class="s-label">ä½œè€…</div>
      <div class="author-list" id="m-author-list"></div>
    </div>
  </div>
</div>

<div id="toast"></div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
(function(){
'use strict';

const LS_FAV   = 'sg_favorites';
const LS_FONT  = 'sg_last_font';

function loadFavs(){
  try{ return JSON.parse(localStorage.getItem(LS_FAV)||'[]'); }catch(e){ return []; }
}
function saveFavs(arr){
  try{ localStorage.setItem(LS_FAV, JSON.stringify(arr)); }catch(e){}
}
function loadFont(){
  try{ return localStorage.getItem(LS_FONT)||''; }catch(e){ return ''; }
}
function saveFont(f){
  try{ localStorage.setItem(LS_FONT, f); }catch(e){}
}

let favorites = loadFavs();

/* é»˜è®¤å±•ç¤ºåœ¨å­—ä½“æ”¶è—æ çš„ä¸‰æ¬¾å­—ä½“ */
const DEFAULT_FONT_IDS = ['f1','f2','f3'];
const LS_FONT_FAV = 'sg_font_favorites';
function loadFontFavs(){ try{ return JSON.parse(localStorage.getItem(LS_FONT_FAV)||'[]'); }catch(e){ return []; } }
function saveFontFavs(arr){ try{ localStorage.setItem(LS_FONT_FAV, JSON.stringify(arr)); }catch(e){} }
let fontFavorites = loadFontFavs();

const FONTS = [
  {id:'f1',type:'font',name:'äº¬åä½“',  author:'milk',       family:'F1',category:'æ‰‹å†™',url:'https://files.catbox.moe/kmyipl.TTF'},
  {id:'f2',type:'font',name:'æ—§æ¬¾å†¬',  author:'è®¨åŒé¦™èœ',   family:'F2',category:'æ‰‹å†™',url:'https://image.uglycat.cc/6wapca.ttf'},
  {id:'f3',type:'font',name:'æˆ‘æœ‰ä¸€ç‚¹æƒ³ä½ ',author:'è€çŒ«',   family:'F3',category:'æ‰‹å†™',url:'https://files.catbox.moe/3bm8wp.ttf'},
  {id:'f4',type:'font',name:'æ–¹æ­£æ¥·ä½“',author:'milk',       family:'F4',category:'æ¥·ä½“',url:'https://files.catbox.moe/caatu4.TTF'}
];

const BUBBLES = [
  {
    id:'b1',type:'bubble',name:'å®è´æˆ‘æ— è¯­äº†',author:'çœ çœ ',
    previews:[{t:'sent',v:'æˆ‘å¯¹è‡ªå·±çš„æˆåŠŸå¾ˆæ»¡æ„'},{t:'received',v:'ä½ æ²¡æœ‰ä½ æƒ³è±¡çš„é‚£ä¹ˆé­'}],
    css:`.message{box-shadow:none !important;border-width:0 !important;font-weight:500 !important;position:relative;overflow:visible !important}
.message::after{content:'' !important;position:absolute !important;width:0 !important;height:0 !important;border-style:solid !important}
.message.message-sent::after{bottom:10px !important;right:-5px !important;border-width:4px 0 0 5px !important;border-color:transparent transparent transparent #F8F8F8 !important;filter:drop-shadow(1px 1px 2px rgba(0,0,0,.1))}
.message.message-received::after{bottom:10px !important;left:-5px !important;border-width:0 0 4px 5px !important;border-color:transparent transparent #fff transparent !important;filter:drop-shadow(1px 1px 2px rgba(0,0,0,.1))}
.message-sent::before{content:"â€¢â€¢â€¢" !important;position:absolute !important;top:-18px !important;left:-15px !important;font-size:6px !important;letter-spacing:.8px !important;color:#444 !important;background:#F8F8F8 !important;padding:3px 7px !important;border-radius:12px 8px 8px 12px !important;line-height:1 !important;font-weight:800 !important;text-align:center !important;box-shadow:-2px -2px 4px rgba(255,255,255,.9),3px 3px 6px rgba(160,160,160,.3),inset 1px 1px 2px rgba(255,255,255,.8),inset -1px -1px 2px rgba(0,0,0,.03) !important;z-index:3 !important}
.message-received::before{content:"â™¥ï¸+520" !important;position:absolute !important;top:-12px !important;right:-35px !important;font-size:7px !important;letter-spacing:.4px !important;color:#F1BFCB !important;background:#fff !important;padding:3px 6px !important;border-radius:6px 10px 10px 6px !important;line-height:1 !important;font-weight:500 !important;text-align:center !important;white-space:nowrap !important;box-shadow:-2px -2px 4px rgba(255,255,255,.9),3px 3px 5px rgba(180,180,180,.2),inset 1px 1px 2px rgba(255,255,255,.8),inset -1px -1px 2px rgba(0,0,0,.02) !important;z-index:3 !important}
.message-received{background:#fff !important;border-color:transparent !important;color:#000 !important;border-radius:24px 24px 24px 4px !important;padding:8px 16px !important;box-shadow:-3px -3px 6px rgba(255,255,255,.8),4px 4px 8px rgba(180,180,180,.25),inset 2px 2px 4px rgba(255,255,255,.9),inset -2px -2px 4px rgba(0,0,0,.05) !important;position:relative}
.message-sent{background:#F8F8F8 !important;border-color:transparent !important;color:#000 !important;border-radius:24px 24px 4px 24px !important;padding:8px 16px !important;box-shadow:-4px -4px 8px rgba(255,255,255,.9),5px 5px 10px rgba(150,150,150,.2),inset 2px 2px 4px rgba(255,255,255,.9),inset -2px -2px 4px rgba(0,0,0,.03) !important;position:relative;background-image:radial-gradient(circle at 35% 35%,rgba(255,255,255,.5) 0%,#F8F8F8 70%) !important}`
  },
  {
    id:'b2',type:'bubble',name:'å°å°¾å·´',author:'milk',
    previews:[{t:'sent',v:'å¯æ˜¯æˆ‘ä¸è§‰å¾—æˆ‘çˆ±ä½ '},{t:'received',v:'é‚£ä½ æ­¤åˆ»æ„¿æ„å‘æˆ‘æ•å¼€å¿ƒæ‰‰å—ï¼Ÿ'},{t:'sent',v:'æ„¿æ„ã€‚'},{t:'received',v:'æˆ‘çš„è£å¹¸ã€‚'}],
    css:`.message{box-shadow:none !important;border-width:0 !important;font-weight:500 !important;position:relative !important;overflow:visible !important;padding:7px 13px !important;line-height:1.3 !important;word-break:break-word !important;border-radius:18px !important;box-shadow:0 2px 3px rgba(0,0,0,.1) !important}
.message-received{background:#fff !important;border-color:transparent !important;color:#000 !important;border-radius:24px 24px 24px 4px !important;padding:8px 16px !important;box-shadow:0 4px 8px rgba(0,0,0,.15) !important}
.message-sent{background:#ffe8ec !important;border-color:transparent !important;color:#000 !important;border-radius:24px 24px 4px 24px !important;padding:8px 16px !important;box-shadow:0 4px 8px rgba(180,120,140,.3) !important}
.message::after{content:'' !important;position:absolute !important;width:30px !important;height:15px !important;background-size:contain !important;background-repeat:no-repeat !important;z-index:0 !important}
.message.message-sent::after{bottom:-4.1px !important;right:-19px !important;background-image:url('https://files.catbox.moe/pe52nt.png') !important;filter:drop-shadow(5.2px 4.1px 5px rgba(180,120,140,.4)) !important}
.message.message-received::after{bottom:-3.9px !important;left:-6.6px !important;background-image:url('https://files.catbox.moe/9exvg6.png') !important;filter:drop-shadow(-3px 5px 4px rgba(0,0,0,.2)) !important}`
  },
  {
    id:'b3',type:'bubble',name:'å°æ°”æ³¡',author:'å®¶å¤«æ˜¯å°çŒ«^^',
    previews:[{t:'sent',v:'æˆ‘è®¸æ„¿ä¸€ä¸ªæœ‰ä½ çš„å†¬å¤©'},{t:'received',v:'æˆ‘å››å­£éƒ½åœ¨'}],
    css:`.message-sent{border-radius:16px 16px 0 16px !important;box-shadow:0 2px 8px rgba(0,0,0,.12),0 1px 3px rgba(0,0,0,.08) !important;background:rgba(255,255,255,.1) !important;border:1px solid rgba(255,255,255,.2) !important;backdrop-filter:blur(8px) !important;-webkit-backdrop-filter:blur(8px) !important;padding:8px 12px !important;margin:3px 0 3px auto !important;font-size:14px !important;color:#888 !important;position:relative !important;z-index:1 !important;display:inline-block !important;max-width:none !important}
.message-received{border-radius:16px 16px 16px 0 !important;box-shadow:0 2px 8px rgba(0,0,0,.12),0 1px 3px rgba(0,0,0,.08) !important;background:rgba(255,255,255,.1) !important;border:1px solid rgba(255,255,255,.2) !important;backdrop-filter:blur(8px) !important;-webkit-backdrop-filter:blur(8px) !important;padding:8px 12px !important;margin:3px auto 3px 0 !important;font-size:14px !important;color:#555 !important;position:relative !important;z-index:1 !important;display:inline-block !important;max-width:none !important}`
  },
  /* â”€â”€ ç«‹ä½“ç°ç³»åˆ—ï¼ˆä»Šå¤©åƒä»€ä¹ˆèˆŸï¼ŒåŒç»„å˜ä½“ï¼‰ â”€â”€ */
  {
    id:'b4',type:'bubble',name:'æ— é˜´å½±',author:'ä»Šå¤©åƒä»€ä¹ˆèˆŸ',
    group:'g-stereo-gray',groupLabel:'ç«‹ä½“ç°ç³»åˆ—',
    previews:[{t:'received',v:'æˆ‘å¿ƒå¯é‰´ï¼Œè¯·ä½ é™ªæˆ‘ä¸€å¹´å†ä¸€å¹´ã€‚'},{t:'sent',v:'å¥½ã€‚'}],
    css:`.message {
  border-radius: 24px !important;
  background: #5A5A5D !important;
  background: linear-gradient(145deg, #626265, #525255) !important;
  box-shadow: 0 3px 8px rgba(0,0,0,0.2) !important;
  overflow: visible !important;
  position: relative !important;
  border: none !important;
}
.message::before {
  content: '' !important;
  position: absolute !important;
  top: 0px !important;
  left: 50% !important;
  transform: translateX(-50%) !important;
  width: 90% !important;
  height: 45% !important;
  border-radius: 24px !important;
  background: linear-gradient(to bottom, rgba(255,255,255,0.28), transparent) !important;
  pointer-events: none !important;
  z-index: 1 !important;
}
.message.message-received,
.message.message-sent {
  color: #ffffff !important;
}
.message blockquote,
.message .quote,
.message .blockquote,
.message [class*="quote"] {
  color: #ffffff !important;
  background-color: rgba(255, 255, 255, 0.2) !important;
  border-left: 3px solid rgba(255, 255, 255, 0.5) !important;
  padding: 8px 12px !important;
  margin: 8px 0 !important;
  border-radius: 8px !important;
  font-style: normal !important;
}
.message blockquote p,
.message .quote p,
.message [class*="quote"] p {
  color: #ffffff !important;
}
.message blockquote {
  position: relative !important;
  z-index: 2 !important;
}`
  },
  {
    id:'b5',type:'bubble',name:'æœ‰é˜´å½±',author:'ä»Šå¤©åƒä»€ä¹ˆèˆŸ',
    group:'g-stereo-gray',groupLabel:'ç«‹ä½“ç°',
    previews:[{t:'received',v:'æˆ‘å¿ƒå¯é‰´ï¼Œè¯·ä½ é™ªæˆ‘ä¸€å¹´å†ä¸€å¹´ã€‚'},{t:'sent',v:'å¥½ã€‚'}],
    css:`.message {
  border-radius: 24px !important;
  background: #5A5A5D !important;
  background: linear-gradient(145deg, #626265, #525255) !important;
  box-shadow: 4px 6px 15px rgba(0, 0, 0, 0.25),
               -2px -2px 10px rgba(255, 255, 255, 0.03) !important;
  overflow: visible !important;
  position: relative !important;
  border: none !important;
}
.message::before {
  content: '' !important;
  position: absolute !important;
  top: 0px !important;
  left: 50% !important;
  transform: translateX(-50%) !important;
  width: 90% !important;
  height: 45% !important;
  border-radius: 24px !important;
  background: linear-gradient(to bottom, rgba(255,255,255,0.28), transparent) !important;
  pointer-events: none !important;
  z-index: 1 !important;
}
.message.message-received,
.message.message-sent {
  color: #ffffff !important;
}
.message blockquote,
.message .quote,
.message .blockquote,
.message [class*="quote"] {
  color: #ffffff !important;
  background-color: rgba(255, 255, 255, 0.2) !important;
  border-left: 3px solid rgba(255, 255, 255, 0.5) !important;
  padding: 8px 12px !important;
  margin: 8px 0 !important;
  border-radius: 8px !important;
  font-style: normal !important;
}
.message blockquote p,
.message .quote p,
.message [class*="quote"] p {
  color: #ffffff !important;
}
.message blockquote {
  position: relative !important;
  z-index: 2 !important;
}`
  },
  /* â”€â”€ milk ç³»åˆ—æ°”æ³¡ â”€â”€ */
  {
    id:'b6',type:'bubble',name:'ç»†çº¿è½®å»“',author:'milk',
    previews:[{t:'sent',v:'å¯æ˜¯æˆ‘ä¸è§‰å¾—æˆ‘çˆ±ä½ '},{t:'received',v:'é‚£ä½ æ­¤åˆ»æ„¿æ„å‘æˆ‘æ•å¼€å¿ƒæ‰‰å—ï¼Ÿ'}],
    css:`.message {
    box-shadow: none !important;
    border-width: 2px !important;
    border-style: solid !important;
    font-weight: 500 !important;
}
.message-sent {
    background: transparent !important;
    border-color: var(--accent-color) !important;
    color: var(--accent-color) !important;
    border-radius: 20px !important;
}
.message-received {
    background: transparent !important;
    border-color: #ccc !important;
    color: var(--text-primary) !important;
    border-radius: 20px !important;
}`
  },
  {
    id:'b7',type:'bubble',name:'å°ç« æ–¹å—',author:'milk',
    previews:[{t:'sent',v:'å¯æ˜¯æˆ‘ä¸è§‰å¾—æˆ‘çˆ±ä½ '},{t:'received',v:'é‚£ä½ æ­¤åˆ»æ„¿æ„å‘æˆ‘æ•å¼€å¿ƒæ‰‰å—ï¼Ÿ'}],
    css:`.message {
    border-radius: 4px !important;
    box-shadow: 
        2px 2px 0px 0px rgba(0,0,0,0.2),
        inset 1px 1px 0px 0px rgba(255,255,255,0.5) !important;
}
.message-sent {
    background-color: var(--accent-color) !important;
    color: #000 !important;
    border: 2px solid #000 !important;
}
.message-received {
    background-color: #fff !important;
    color: #000 !important;
    border: 2px solid #000 !important;
}`
  },
  {
    id:'b8',type:'bubble',name:'ç´ ææŠ•å½±',author:'milk',
    previews:[{t:'sent',v:'å¯æ˜¯æˆ‘ä¸è§‰å¾—æˆ‘çˆ±ä½ '},{t:'received',v:'é‚£ä½ æ­¤åˆ»æ„¿æ„å‘æˆ‘æ•å¼€å¿ƒæ‰‰å—ï¼Ÿ'}],
    css:`.message {
    border-radius: 4px !important;
    box-shadow: 5px 5px 0px rgba(0,0,0,0.1) !important;
}`
  },
  {
    id:'b9',type:'bubble',name:'æ¸å˜é«˜å…‰',author:'milk',
    previews:[{t:'sent',v:'å¯æ˜¯æˆ‘ä¸è§‰å¾—æˆ‘çˆ±ä½ '},{t:'received',v:'é‚£ä½ æ­¤åˆ»æ„¿æ„å‘æˆ‘æ•å¼€å¿ƒæ‰‰å—ï¼Ÿ'}],
    css:`.message {
    border-radius: 18px !important;
    box-shadow: 
        0 2px 8px rgba(0, 0, 0, 0.08),
        inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;
    transition: all 0.2s ease !important;
}
.message-sent {
    background: 
        linear-gradient(135deg, 
            var(--accent-color) 0%, 
            color-mix(in srgb, var(--accent-color), #000 15%) 100%
        ) !important;
    color: #000000 !important;  
    border: none !important;
    border-bottom-right-radius: 4px !important;
    margin-left: auto !important; 
    position: relative !important;
}
.message-sent::before {
    content: '' !important;
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    height: 30% !important;
    background: linear-gradient(to bottom, 
        rgba(255, 255, 255, 0.15) 0%, 
        rgba(255, 255, 255, 0) 100%) !important;
    border-radius: 18px 18px 0 0 !important;
    pointer-events: none !important;
}
.message-received {
    background: var(--secondary-bg) !important;
    color: var(--text-primary, #333) !important;
    border: 1px solid rgba(0, 0, 0, 0.08) !important;
    border-bottom-left-radius: 4px !important; 
    margin-right: auto !important;
}
.message-sent:hover {
    box-shadow: 
        0 4px 12px color-mix(in srgb, var(--accent-color) 20%, transparent),
        0 2px 4px rgba(0, 0, 0, 0.1) !important;
}
@media (prefers-color-scheme: dark) {
    .message-received {
        background: color-mix(in srgb, var(--secondary-bg) 90%, #222) !important;
        color: var(--text-primary, #f0f0f0) !important;
        border-color: rgba(255, 255, 255, 0.12) !important;
    }
    .message {
        box-shadow: 
            0 2px 8px rgba(0, 0, 0, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
    }
}`
  },
  {
    id:'b10',type:'bubble',name:'æ©˜çŒ«çˆªå°',author:'milk',
    previews:[{t:'sent',v:'å¯æ˜¯æˆ‘ä¸è§‰å¾—æˆ‘çˆ±ä½ '},{t:'received',v:'é‚£ä½ æ­¤åˆ»æ„¿æ„å‘æˆ‘æ•å¼€å¿ƒæ‰‰å—ï¼Ÿ'}],
    css:`.message {
    position: relative !important;
    overflow: visible !important;
    border-radius: 25px !important; 
    padding: 12px 24px !important;
    font-size: 15px !important;
    box-shadow: 2px 2px 0px rgba(0,0,0,0.1) !important;
}
.message-sent {
    background-color: #ffb347 !important;
    color: #fff !important;
    border: 2px solid #fff !important;
}
.message-sent::after {
    content: "ğŸ±";
    position: absolute;
    bottom: -8px;
    right: -5px;
    font-size: 18px;
    transform: rotate(-15deg);
}
.message-received {
    background-color: #fdf5e6 !important;
    color: #5d4037 !important;
    border: 2px solid #ffb347 !important;
}
.message-received::before {
    content: "ğŸ¾";
    position: absolute;
    top: -8px;
    left: -5px;
    font-size: 16px;
    transform: rotate(-20deg);
    opacity: 0.8;
}`
  },
  {
    id:'b11',type:'bubble',name:'èµ›åšæ•…éšœ',author:'milk',
    previews:[{t:'sent',v:'å¯æ˜¯æˆ‘ä¸è§‰å¾—æˆ‘çˆ±ä½ '},{t:'received',v:'é‚£ä½ æ­¤åˆ»æ„¿æ„å‘æˆ‘æ•å¼€å¿ƒæ‰‰å—ï¼Ÿ'}],
    css:`.message {
    position: relative !important;
    overflow: visible !important;
    letter-spacing: 0.5px;
    border-radius: 4px !important;
    backdrop-filter: blur(5px);
}
.message-sent {
    background-color: rgba(0, 0, 0, 0.8) !important;
    border: 1px solid #00f3ff !important;
    color: #00f3ff !important;
    box-shadow: 0 0 10px rgba(0, 243, 255, 0.3), inset 0 0 5px rgba(0, 243, 255, 0.1) !important;
    border-right: 4px solid #00f3ff !important;
}
.message-sent::after {
    content: "sys_msg >>";
    position: absolute;
    bottom: -16px;
    right: 0;
    font-size: 9px;
    color: #00f3ff;
    opacity: 0.7;
}
.message-received {
    background-color: rgba(0, 0, 0, 0.8) !important;
    border: 1px solid #ff0055 !important;
    color: #ff0055 !important;
    box-shadow: 0 0 10px rgba(255, 0, 85, 0.3) !important;
    border-left: 4px solid #ff0055 !important;
}
.message-received::before {
    content: "âš  INCOMING";
    position: absolute;
    top: -16px;
    left: 0;
    font-size: 9px;
    color: #ff0055;
    opacity: 0.7;
    font-weight: bold;
}`
  },
  {
    id:'b12',type:'bubble',name:'å½©è‰²ä¾¿åˆ©è´´',author:'milk',
    previews:[{t:'sent',v:'å¯æ˜¯æˆ‘ä¸è§‰å¾—æˆ‘çˆ±ä½ '},{t:'received',v:'é‚£ä½ æ­¤åˆ»æ„¿æ„å‘æˆ‘æ•å¼€å¿ƒæ‰‰å—ï¼Ÿ'}],
    css:`.message {
    position: relative !important;
    overflow: visible !important;
    color: #333 !important;
    box-shadow: 2px 4px 8px rgba(0,0,0,0.15) !important;
    border-radius: 2px !important;
    margin-top: 15px !important;
}
.message-sent {
    background-color: #fff740 !important;
    transform: rotate(1deg); 
}
.message-sent::after {
    content: "ğŸ“";
    position: absolute;
    top: -15px;
    right: 40%;
    font-size: 24px;
    z-index: 10;
    filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.2));
}
.message-received {
    background-color: #dbfbfb !important;
    transform: rotate(-1deg);
}
.message-received::before {
    content: "ğŸ“";
    position: absolute;
    top: -12px;
    left: 40%;
    font-size: 20px;
    z-index: 10;
    transform: rotate(45deg);
}`
  },
  {
    id:'b13',type:'bubble',name:'å çº¸ä¹¦é¡µ',author:'milk',
    previews:[{t:'sent',v:'å¯æ˜¯æˆ‘ä¸è§‰å¾—æˆ‘çˆ±ä½ '},{t:'received',v:'é‚£ä½ æ­¤åˆ»æ„¿æ„å‘æˆ‘æ•å¼€å¿ƒæ‰‰å—ï¼Ÿ'}],
    css:`.message {
    position: relative !important;
    overflow: visible !important;
    background-color: #fdfbf7 !important;
    color: #4a4a4a !important;
    box-shadow: 
        0 1px 1px rgba(0,0,0,0.15), 
        0 10px 0 -5px #eee,
        0 10px 1px -4px rgba(0,0,0,0.15), 
        0 20px 0 -10px #e5e5e5,
        0 20px 1px -9px rgba(0,0,0,0.15) !important;
    border: 1px solid #e0dcd5 !important;
    border-radius: 2px !important;
    margin-bottom: 20px !important; 
}
.message-sent {
    border-top: 4px solid #c0392b !important; 
}
.message-received {
    border-top: 4px solid #2980b9 !important;
}`
  },
  /* â”€â”€ T ç³»åˆ—æ°”æ³¡ â”€â”€ */
  {
    id:'b14',type:'bubble',name:'å¥¶æ²¹æ›²å¥‡',author:'T',
    previews:[{t:'sent',v:'ä½ æ˜¯æˆ‘æœå¤•ç›¸ä¼´è§¦æ‰‹å¯åŠçš„è™šæ‹Ÿã€‚'},{t:'received',v:'ä½ æ˜¯æˆ‘æœªæ›¾æ‹¥æœ‰æ— æ³•æ•æ‰çš„äº²æ˜µã€‚'}],
    css:`.message-sent,
.message-received {
    background-color: #fffbf0 !important;
    border: 3px dashed #b8c6db !important;
    color: #555555 !important;
    border-radius: 20px !important;
    box-shadow: 0 4px 0px #e0e7ff !important;
}`
  },
  {
    id:'b15',type:'bubble',name:'æ©˜çŒ«è€³',author:'T',
    previews:[{t:'sent',v:'ä½ æ˜¯æˆ‘æœå¤•ç›¸ä¼´è§¦æ‰‹å¯åŠçš„è™šæ‹Ÿã€‚'},{t:'received',v:'ä½ æ˜¯æˆ‘æœªæ›¾æ‹¥æœ‰æ— æ³•æ•æ‰çš„äº²æ˜µã€‚'}],
    css:`.message-sent,
.message-received {
    background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%) !important;
    color: #5d4037 !important;
    border-radius: 20px 20px 20px 20px !important;
    border: 3px solid #ffffff !important;
    box-shadow: 0 5px 15px rgba(252, 182, 159, 0.4) !important;
    position: relative !important;
    overflow: visible !important;
}
.message-sent::before, .message-received::before {
    content: '' !important;
    position: absolute !important;
    top: -10px !important;
    left: 15px !important;
    width: 0 !important;
    height: 0 !important;
    border-left: 8px solid transparent !important;
    border-right: 8px solid transparent !important;
    border-bottom: 12px solid #fcb69f !important;
    transform: rotate(-15deg) !important;
}
.message-sent::after, .message-received::after {
    content: '' !important;
    position: absolute !important;
    top: -8px !important;
    left: 35px !important;
    width: 0 !important;
    height: 0 !important;
    border-left: 6px solid transparent !important;
    border-right: 6px solid transparent !important;
    border-bottom: 10px solid #fcb69f !important;
    transform: rotate(15deg) !important;
}`
  },
  {
    id:'b16',type:'bubble',name:'è–„è·',author:'T',
    previews:[{t:'sent',v:'ä½ æ˜¯æˆ‘æœå¤•ç›¸ä¼´è§¦æ‰‹å¯åŠçš„è™šæ‹Ÿã€‚'},{t:'received',v:'ä½ æ˜¯æˆ‘æœªæ›¾æ‹¥æœ‰æ— æ³•æ•æ‰çš„äº²æ˜µã€‚'}],
    css:`.message-sent,
.message-received {
    background: rgba(200, 247, 197, 0.6) !important;
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border: 2px solid rgba(255, 255, 255, 0.8) !important;
    color: #2e5c38 !important;
    border-radius: 18px !important;
    box-shadow: 0 4px 0 rgba(160, 210, 160, 0.5) !important;
}`
  },
  {
    id:'b17',type:'bubble',name:'ç®€çº¦é€æ˜',author:'T',
    previews:[{t:'sent',v:'ä½ æ˜¯æˆ‘æœå¤•ç›¸ä¼´è§¦æ‰‹å¯åŠçš„è™šæ‹Ÿã€‚'},{t:'received',v:'ä½ æ˜¯æˆ‘æœªæ›¾æ‹¥æœ‰æ— æ³•æ•æ‰çš„äº²æ˜µã€‚'}],
    css:`.message-sent,
.message-received {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0.1)) !important;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.4) !important;
    border-top: 1px solid rgba(255, 255, 255, 0.6) !important;
    border-left: 1px solid rgba(255, 255, 255, 0.6) !important;
    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
    color: #333333 !important;
    background-color: transparent !important;
}
.message-sent {
    border-radius: 20px 20px 5px 20px;
}
.message-received {
    border-radius: 20px 20px 20px 5px;
}`
  },
  {
    id:'b18',type:'bubble',name:'åƒç´ æ¸¸æˆæ¡†',author:'T',
    previews:[{t:'sent',v:'ä½ æ˜¯æˆ‘æœå¤•ç›¸ä¼´è§¦æ‰‹å¯åŠçš„è™šæ‹Ÿã€‚'},{t:'received',v:'ä½ æ˜¯æˆ‘æœªæ›¾æ‹¥æœ‰æ— æ³•æ•æ‰çš„äº²æ˜µã€‚'}],
    css:`.message-sent,
.message-received {
    background-color: #ffcc00 !important;
    border-radius: 0px !important;
    box-shadow:
        4px 0 0 #000,
        -4px 0 0 #000,
        0 -4px 0 #000,
        0 4px 0 #000,
        8px 8px 0 rgba(0,0,0,0.2) !important;
    color: #000000 !important;
    padding: 12px 15px !important;
    border: none !important;
}`
  },
  {
    id:'b19',type:'bubble',name:'äº‘æœµæ£‰èŠ±ç³–',author:'T',
    previews:[{t:'sent',v:'ä½ æ˜¯æˆ‘æœå¤•ç›¸ä¼´è§¦æ‰‹å¯åŠçš„è™šæ‹Ÿã€‚'},{t:'received',v:'ä½ æ˜¯æˆ‘æœªæ›¾æ‹¥æœ‰æ— æ³•æ•æ‰çš„äº²æ˜µã€‚'}],
    css:`.message-sent,
.message-received {
    background: linear-gradient(to bottom, #fff0f5, #e6e6fa) !important;
    border-radius: 30px 30px 30px 10px !important;
    box-shadow:
        0 10px 20px -5px rgba(216, 191, 216, 0.5),
        inset 0 -3px 10px rgba(255,255,255,0.8) !important;
    color: #6a5acd !important;
    border: 2px solid #ffffff !important;
}
.message-sent {
    border-radius: 30px 30px 10px 30px !important;
}`
  },
  {
    id:'b20',type:'bubble',name:'æš—å¤œè•¾ä¸',author:'T',
    previews:[{t:'sent',v:'ä½ æ˜¯æˆ‘æœå¤•ç›¸ä¼´è§¦æ‰‹å¯åŠçš„è™šæ‹Ÿã€‚'},{t:'received',v:'ä½ æ˜¯æˆ‘æœªæ›¾æ‹¥æœ‰æ— æ³•æ•æ‰çš„äº²æ˜µã€‚'}],
    css:`.message-sent,
.message-received {
    background-color: #2b2b2b !important;
    border: 2px solid #ff69b4 !important;
    outline: 2px dashed #ff69b4 !important;
    outline-offset: 3px;
    color: #ffb6c1 !important;
    border-radius: 10px !important;
    box-shadow: 0 0 15px rgba(255, 105, 180, 0.3) !important;
    font-weight: bold !important;
    margin: 10px !important;
}`
  },
  {
    id:'b21',type:'bubble',name:'æ†¨æ†¨å°ç†Š',author:'T',
    previews:[{t:'sent',v:'ä½ æ˜¯æˆ‘æœå¤•ç›¸ä¼´è§¦æ‰‹å¯åŠçš„è™šæ‹Ÿã€‚'},{t:'received',v:'ä½ æ˜¯æˆ‘æœªæ›¾æ‹¥æœ‰æ— æ³•æ•æ‰çš„äº²æ˜µã€‚'}],
    css:`.message-sent,
.message-received {
    background-color: #f6d365 !important;
    border: 4px solid #5d4037 !important;
    color: #3e2723 !important;
    border-radius: 25px !important;
    box-shadow: none !important;
}
.message-sent {
    border-top-right-radius: 5px !important;
}
.message-received {
    border-top-left-radius: 5px !important;
}`
  },
  {
    id:'b22',type:'bubble',name:'èœ˜è››',author:'T',
    previews:[{t:'sent',v:'ä½ æ˜¯æˆ‘æœå¤•ç›¸ä¼´è§¦æ‰‹å¯åŠçš„è™šæ‹Ÿã€‚'},{t:'received',v:'ä½ æ˜¯æˆ‘æœªæ›¾æ‹¥æœ‰æ— æ³•æ•æ‰çš„äº²æ˜µã€‚'}],
    css:`.message-sent,
.message-received {
    background-color: #2c3e50 !important;
    color: #ecf0f1 !important;
    border-radius: 30px !important;
    border: 3px solid #e74c3c !important;
    box-shadow: 0 8px 15px rgba(44, 62, 80, 0.4) !important;
    background-image: radial-gradient(circle at 10px 10px, #e74c3c 2px, transparent 3px),
                      radial-gradient(circle at 25px 10px, #e74c3c 2px, transparent 3px) !important;
    background-repeat: no-repeat !important;
    padding-top: 15px !important;
}`
  },
  {
    id:'b23',type:'bubble',name:'ç³»ç»Ÿæç¤º',author:'T',
    previews:[{t:'sent',v:'ä½ æ˜¯æˆ‘æœå¤•ç›¸ä¼´è§¦æ‰‹å¯åŠçš„è™šæ‹Ÿã€‚'},{t:'received',v:'ä½ æ˜¯æˆ‘æœªæ›¾æ‹¥æœ‰æ— æ³•æ•æ‰çš„äº²æ˜µã€‚'}],
    css:`.message-sent,
.message-received {
    background-color: #000000 !important;
    color: #ffffff !important;
    border-left: 5px solid #ff0000 !important;
    border-top: 1px solid #333 !important;
    border-right: 1px solid #333 !important;
    border-bottom: 1px solid #333 !important;
    border-radius: 4px !important;
    box-shadow: 0 0 10px rgba(255, 0, 0, 0.2) !important;
    font-weight: 500 !important;
}`
  },
  {
    id:'b24',type:'bubble',name:'ç™½éª¨çº¢ç—•',author:'T',
    previews:[{t:'sent',v:'ä½ æ˜¯æˆ‘æœå¤•ç›¸ä¼´è§¦æ‰‹å¯åŠçš„è™šæ‹Ÿã€‚'},{t:'received',v:'ä½ æ˜¯æˆ‘æœªæ›¾æ‹¥æœ‰æ— æ³•æ•æ‰çš„äº²æ˜µã€‚'}],
    css:`.message-sent,
.message-received {
    background-color: #ffffff !important;
    color: #000000 !important;
    border: 3px solid #000000 !important;
    box-shadow: 6px 6px 0px #ff0000 !important;
    border-radius: 8px !important;
    padding: 12px 16px !important;
    transform: rotate(-1deg) !important; 
}`
  },
  {
    id:'b25',type:'bubble',name:'æ·±æ¸Šå¿ƒè„',author:'T',
    previews:[{t:'sent',v:'ä½ æ˜¯æˆ‘æœå¤•ç›¸ä¼´è§¦æ‰‹å¯åŠçš„è™šæ‹Ÿã€‚'},{t:'received',v:'ä½ æ˜¯æˆ‘æœªæ›¾æ‹¥æœ‰æ— æ³•æ•æ‰çš„äº²æ˜µã€‚'}],
    css:`.message-sent,
.message-received {
    background: linear-gradient(160deg, #1a1a1a 0%, #4a0000 100%) !important;
    color: #ffffff !important;
    border: 1px solid rgba(255, 255, 255, 0.3) !important;
    border-radius: 15px 0 15px 0 !important;
    box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.8) !important;
    letter-spacing: 0.5px !important;
}`
  }
];

const ALL = [...BUBBLES, ...FONTS];

let state = { type:'all', author:'all', query:'', fontFamily: loadFont() };
let currentModalItem = null;

function toast(msg, dur=2800){
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.classList.add('show');
  clearTimeout(el._t);
  el._t = setTimeout(()=>el.classList.remove('show'), dur);
}

function copyText(text, label){
  if(navigator.clipboard && window.isSecureContext){
    navigator.clipboard.writeText(text).then(()=>toast('âœ… å·²å¤åˆ¶ ' + label));
  } else {
    const ta = document.createElement('textarea');
    ta.value = text; ta.style.cssText='position:fixed;opacity:0';
    document.body.appendChild(ta); ta.focus(); ta.select();
    try{ document.execCommand('copy'); toast('âœ… å·²å¤åˆ¶ ' + label); }
    catch(e){ toast('âŒ å¤åˆ¶å¤±è´¥'); }
    document.body.removeChild(ta);
  }
}

function isFav(id){ return favorites.includes(id); }

function toggleFav(id){
  if(isFav(id)){
    favorites = favorites.filter(f=>f!==id);
  } else {
    favorites.push(id);
  }
  saveFavs(favorites);
  // åŒæ­¥å­—ä½“æ”¶è—åˆ—è¡¨
  const fontItem = FONTS.find(f=>f.id===id);
  if(fontItem){
    if(isFav(id)){
      if(!fontFavorites.includes(id)) fontFavorites.push(id);
    } else {
      fontFavorites = fontFavorites.filter(f=>f!==id);
    }
    saveFontFavs(fontFavorites);
  }
  updateFavCounts();
  const cards = document.querySelectorAll('#card-grid .item-card');
  cards.forEach(c=>{ if(c.dataset.id===id){ c.classList.toggle('favorited', isFav(id)); } });
  const mb = document.getElementById('modal-fav-btn');
  if(currentModalItem && currentModalItem.id===id){
    mb.classList.toggle('on', isFav(id));
    mb.title = isFav(id) ? 'å–æ¶ˆæ”¶è—' : 'æ”¶è—';
  }
  if(state.type==='fav') renderCards();
}

function updateFavCounts(){
  const n = favorites.filter(id=>ALL.some(i=>i.id===id)).length;
  ['c-fav','mc-fav'].forEach(id=>{ const el=document.getElementById(id); if(el) el.textContent=n; });
}

function getFiltered(){
  const q = state.query.toLowerCase();
  return ALL.filter(item=>{
    if(state.type==='fav' && !isFav(item.id)) return false;
    if(state.type!=='all' && state.type!=='fav' && item.type!==state.type) return false;
    if(state.author!=='all' && item.author!==state.author) return false;
    if(q && !item.name.toLowerCase().includes(q) && !item.author.toLowerCase().includes(q)) return false;
    return true;
  });
}

function countFor(type){
  return ALL.filter(item=>{
    if(type==='fav' && !isFav(item.id)) return false;
    if(type!=='all' && type!=='fav' && item.type!==type) return false;
    if(state.author!=='all' && item.author!==state.author) return false;
    const q = state.query.toLowerCase();
    if(q && !item.name.toLowerCase().includes(q) && !item.author.toLowerCase().includes(q)) return false;
    return true;
  }).length;
}

function renderCounts(){
  ['all','bubble','font','fav'].forEach(t=>{
    const n = countFor(t);
    ['c-'+t, 'mc-'+t].forEach(id=>{
      const el = document.getElementById(id);
      if(el) el.textContent = n;
    });
  });
}

function renderAuthors(){
  const authorMap = {};
  ALL.forEach(i=>{ authorMap[i.author] = (authorMap[i.author]||0)+1; });

  ['author-list','m-author-list'].forEach(listId=>{
    const el = document.getElementById(listId);
    if(!el) return;
    el.innerHTML = '';

    const allChip = document.createElement('div');
    allChip.className = 'author-chip' + (state.author==='all'?' active':'');
    allChip.dataset.author = 'all';
    allChip.innerHTML = 'å…¨éƒ¨ <span class="author-chip-n">'+ALL.length+'</span>';
    allChip.onclick = ()=>setAuthor('all');
    el.appendChild(allChip);

    Object.entries(authorMap).forEach(([name,n])=>{
      const d = document.createElement('div');
      d.className = 'author-chip' + (state.author===name?' active':'');
      d.dataset.author = name;
      d.innerHTML = name + ' <span class="author-chip-n">'+n+'</span>';
      d.onclick = ()=>setAuthor(name);
      el.appendChild(d);
    });
  });
}

function renderCards(){
  const grid = document.getElementById('card-grid');
  grid.innerHTML = '';
  const filtered = getFiltered();

  renderCounts();

  if(!filtered.length){
    grid.innerHTML = `<div class="empty-state">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
      ${state.type==='fav' ? 'è¿˜æ²¡æœ‰æ”¶è—ï¼Œç‚¹å‡» â™¡ æ”¶è—å–œæ¬¢çš„æ ·å¼' : 'æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å†…å®¹'}
    </div>`;
    return;
  }

  const renderedGroups = new Set();
  // è®¡ç®—å®é™…æ˜¾ç¤ºå¡ç‰‡æ•°
  let visibleCount = 0;
  filtered.forEach(item=>{
    if(item.group){ if(!renderedGroups.has(item.group)){ visibleCount++; renderedGroups.add(item.group); } }
    else { visibleCount++; }
  });
  document.getElementById('toolbar-info').textContent = visibleCount + ' ä¸ªç»“æœ';
  renderedGroups.clear();

  // è¿½è¸ªæ¯å¼ å¡ç‰‡å½“å‰é€‰ä¸­çš„å˜ä½“
  const groupSelected = {};

  filtered.forEach((item, i)=>{
    // å¦‚æœæ˜¯åŒç³»åˆ—å˜ä½“ï¼Œåªæ˜¾ç¤ºä¸€å¼ å¡ç‰‡
    if(item.group){
      if(renderedGroups.has(item.group)) return;
      renderedGroups.add(item.group);
    }

    // è¯¥å¡ç‰‡ä»£è¡¨çš„å®é™… itemï¼ˆå¯¹äºç³»åˆ—å¡ç‰‡ï¼Œä»ç¬¬ä¸€ä¸ªå˜ä½“å¼€å§‹ï¼‰
    const siblings = item.group ? BUBBLES.filter(b=>b.group===item.group) : null;
    const activeItem = item; // åˆå§‹é€‰ä¸­å½“å‰ item

    if(item.group) groupSelected[item.group] = item.id;

    const card = document.createElement('div');
    card.className = 'item-card' + (isFav(item.id)?' favorited':'');
    card.style.animationDelay = Math.min(i * 0.04, 0.3) + 's';
    card.dataset.id = item.id;

    const badge = item.type==='bubble'
      ? '<span class="card-badge badge-bubble">æ°”æ³¡</span>'
      : '<span class="card-badge badge-font">å­—ä½“</span>';
    const nameStyle = item.type==='font' ? `style="font-family:${item.family}"` : '';
    const copyIcon = item.type==='bubble'
      ? '<rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>'
      : '<path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>';
    const favOn = isFav(item.id);

    // ç³»åˆ—æ°”æ³¡ï¼šæ˜¾ç¤ºå˜ä½“é€‰æ‹©å™¨
    const variantHTML = siblings && siblings.length > 1 ? `
      <div class="card-variants">
        ${siblings.map(s=>`<button class="card-var-btn${s.id===item.id?' active':''}" data-var-id="${s.id}" data-var-name="${s.name}">${s.name}</button>`).join('')}
      </div>` : '';

    card.innerHTML = `
      <div class="card-top">
        <span class="card-name" ${nameStyle}>${item.group ? (item.groupLabel||item.group) : item.name}${item.group?'<span class="card-group-dot" title="åŒç³»åˆ—å˜ä½“"></span>':''}</span>
        ${badge}
      </div>
      <span class="card-author">${item.author}</span>
      ${variantHTML}
      <div class="card-actions">
        <button class="btn-preview">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
          é¢„è§ˆ
        </button>
        <button class="btn-icon btn-fav ${favOn?'on':''}" title="${favOn?'å–æ¶ˆæ”¶è—':'æ”¶è—'}">
          <svg viewBox="0 0 24 24" fill="${favOn?'currentColor':'none'}" stroke="currentColor"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
        </button>
        <button class="btn-icon btn-copy" title="å¤åˆ¶">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">${copyIcon}</svg>
        </button>
      </div>
    `;

    // å˜ä½“é€‰æ‹©å™¨é€»è¾‘
    if(siblings && siblings.length > 1){
      card.querySelectorAll('.card-var-btn').forEach(vBtn=>{
        vBtn.addEventListener('click', e=>{
          e.stopPropagation();
          const varId = vBtn.dataset.varId;
          groupSelected[item.group] = varId;
          card.querySelectorAll('.card-var-btn').forEach(b=>b.classList.toggle('active', b.dataset.varId===varId));
          // æ›´æ–°é¢„è§ˆæŒ‰é’®æ‰“å¼€å¯¹åº”å˜ä½“
          const selSib = siblings.find(s=>s.id===varId);
          if(selSib){
            card.dataset.id = varId;
            card.querySelector('.btn-preview').dataset.varId = varId;
          }
        });
      });
    }

    // é¢„è§ˆæŒ‰é’®ï¼šæ‰“å¼€å½“å‰é€‰ä¸­å˜ä½“
    card.querySelector('.btn-preview').addEventListener('click', e=>{
      e.stopPropagation();
      if(item.group){
        const selId = groupSelected[item.group] || item.id;
        const selItem = BUBBLES.find(b=>b.id===selId) || item;
        openModal(selItem);
      } else {
        openModal(item);
      }
    });

    // æ”¶è—æŒ‰é’®
    card.querySelector('.btn-fav').addEventListener('click', e=>{
      e.stopPropagation();
      toggleFav(item.id);
      const b=e.currentTarget;
      const on=isFav(item.id);
      b.classList.toggle('on',on);
      b.title=on?'å–æ¶ˆæ”¶è—':'æ”¶è—';
      b.querySelector('svg').setAttribute('fill',on?'currentColor':'none');
    });

    // å¤åˆ¶æŒ‰é’®ï¼šå¤åˆ¶å½“å‰é€‰ä¸­å˜ä½“
    card.querySelector('.btn-copy').addEventListener('click', e=>{
      e.stopPropagation();
      if(item.group){
        const selId = groupSelected[item.group] || item.id;
        const selItem = siblings.find(s=>s.id===selId) || item;
        const selName = selItem.name;
        copyText(selItem.css, `CSSï¼ˆ${selName}ï¼‰`);
      } else {
        copyText(item.type==='bubble'?item.css:item.url, item.type==='bubble'?'CSS':'å­—ä½“é“¾æ¥');
      }
    });

    // ç‚¹å‡»å¡ç‰‡æ‰“å¼€é¢„è§ˆï¼ˆåŒå˜ä½“é€‰ä¸­ï¼‰
    card.addEventListener('click', ()=>{
      if(item.group){
        const selId = groupSelected[item.group] || item.id;
        const selItem = BUBBLES.find(b=>b.id===selId) || item;
        openModal(selItem);
      } else {
        openModal(item);
      }
    });

    grid.appendChild(card);
  });
}

function openModal(item){
  currentModalItem = item;
  const backdrop = document.getElementById('modal-backdrop');
  const body     = document.getElementById('modal-body');
  const footer   = document.getElementById('modal-footer');
  const name     = document.getElementById('modal-name');
  const badgeEl  = document.getElementById('modal-badge');
  const favBtn   = document.getElementById('modal-fav-btn');

  name.textContent = item.name;
  badgeEl.innerHTML = item.type==='bubble'
    ? '<span class="card-badge badge-bubble">æ°”æ³¡</span>'
    : '<span class="card-badge badge-font">å­—ä½“</span>';

  const favOn = isFav(item.id);
  favBtn.classList.toggle('on', favOn);
  favBtn.title = favOn ? 'å–æ¶ˆæ”¶è—' : 'æ”¶è—';
  favBtn.querySelector('svg').setAttribute('fill', favOn ? 'currentColor' : 'none');
  favBtn.onclick = ()=>toggleFav(item.id);

  body.innerHTML = '';
  footer.innerHTML = '';

  if(item.type === 'bubble'){
    document.getElementById('dbs').textContent = item.css;

    function renderBubblePreviews(previewItem){
      body.innerHTML = '';
      document.getElementById('dbs').textContent = previewItem.css;
      currentModalItem = previewItem;
      document.getElementById('modal-name').textContent = previewItem.name;
      const favOn2 = isFav(previewItem.id);
      favBtn.classList.toggle('on', favOn2);
      favBtn.title = favOn2 ? 'å–æ¶ˆæ”¶è—' : 'æ”¶è—';
      favBtn.querySelector('svg').setAttribute('fill', favOn2 ? 'currentColor' : 'none');
      favBtn.onclick = ()=>toggleFav(previewItem.id);
      (previewItem.previews || [{t:'sent',v:'ä½ å¥½'},{t:'received',v:'ä½ å¥½å‘€'}]).forEach(msg=>{
        const row = document.createElement('div');
        row.className = 'msg-row ' + msg.t;
        const bub = document.createElement('div');
        bub.className = 'message message-' + msg.t;
        bub.textContent = msg.v;
        row.appendChild(bub);
        body.appendChild(row);
      });
      body.style.fontFamily = state.fontFamily;
    }

    renderBubblePreviews(item);

    const modalState = { fontFamily: state.fontFamily };
    body.style.fontFamily = modalState.fontFamily;

    if(item.group){
      const siblings = BUBBLES.filter(b=>b.group===item.group);
      if(siblings.length > 1){
        const varSection = document.createElement('div');
        varSection.className = 'variant-section';
        const varLabel = document.createElement('div');
        varLabel.className = 'variant-label';
        varLabel.innerHTML = `åŒç³»åˆ—å˜ä½“ <span class="variant-tag">${item.groupLabel||item.group}</span>`;
        varSection.appendChild(varLabel);
        const varRow = document.createElement('div');
        varRow.className = 'variant-row';
        siblings.forEach(sib=>{
          const vBtn = document.createElement('button');
          vBtn.className = 'variant-btn' + (sib.id===item.id?' active':'');
          vBtn.textContent = sib.name;
          vBtn.dataset.varId = sib.id;
          vBtn.addEventListener('click', ()=>{
            renderBubblePreviews(sib);
            varRow.querySelectorAll('.variant-btn').forEach(b=>b.classList.toggle('active', b.dataset.varId===sib.id));
            footer.querySelector('.copy-css-btn').onclick = ()=>copyText(sib.css,'CSS');
          });
          varRow.appendChild(vBtn);
        });
        varSection.appendChild(varRow);
        footer.appendChild(varSection);
      }
    }

    // â”€â”€â”€ æ”¶è—å­—ä½“åˆ‡æ¢ â”€â”€â”€
    const switchLabel = document.createElement('div');
    switchLabel.className = 'font-switch-label';
    switchLabel.textContent = 'æ”¶è—å­—ä½“';
    footer.appendChild(switchLabel);

    // é»˜è®¤ä¸‰æ¬¾
    const defSection = document.createElement('div');
    defSection.className = 'font-cat-section';
    const defHeader = document.createElement('div');
    defHeader.className = 'font-cat-header';
    const defCatLabel = document.createElement('span');
    defCatLabel.className = 'font-cat-name';
    defCatLabel.textContent = 'é»˜è®¤';
    defHeader.appendChild(defCatLabel);
    defSection.appendChild(defHeader);
    const defRow = document.createElement('div');
    defRow.className = 'modal-footer-row';

    const defBtn = document.createElement('button');
    defBtn.className = 'font-btn' + (modalState.fontFamily==='' ? ' active' : '');
    defBtn.textContent = 'é»˜è®¤å­—ä½“';
    defBtn.onclick = ()=>{ modalState.fontFamily=''; body.style.fontFamily=''; saveFont(''); updateFontBtns(footer, modalState); };
    defRow.appendChild(defBtn);

    // ä¸‰æ¬¾é»˜è®¤å­—ä½“
    const defaultFonts = FONTS.filter(f=>DEFAULT_FONT_IDS.includes(f.id));
    defaultFonts.forEach(f=>{
      const btn = document.createElement('button');
      btn.className = 'font-btn' + (modalState.fontFamily===f.family ? ' active' : '');
      btn.style.fontFamily = f.family;
      btn.dataset.family = f.family;
      btn.textContent = f.name;
      btn.onclick = ()=>{ modalState.fontFamily=f.family; body.style.fontFamily=f.family; saveFont(f.family); updateFontBtns(footer, modalState); };
      defRow.appendChild(btn);
    });
    defSection.appendChild(defRow);
    footer.appendChild(defSection);

    // å·²æ”¶è—å­—ä½“ï¼ˆæ”¶è—äº†ä½†ä¸åœ¨é»˜è®¤åˆ—è¡¨é‡Œçš„å­—ä½“ï¼‰
    const favFonts = FONTS.filter(f=>fontFavorites.includes(f.id) && !DEFAULT_FONT_IDS.includes(f.id));
    const favFontSection = document.createElement('div');
    favFontSection.className = 'font-cat-section';
    const favFontHeader = document.createElement('div');
    favFontHeader.className = 'font-cat-header';
    const favCatLabel = document.createElement('span');
    favCatLabel.className = 'font-cat-name';
    favCatLabel.textContent = 'å·²æ”¶è—';
    favFontHeader.appendChild(favCatLabel);
    favFontSection.appendChild(favFontHeader);
    const favFontRow = document.createElement('div');
    favFontRow.className = 'modal-footer-row';
    if(favFonts.length === 0){
      const hint = document.createElement('span');
      hint.style.cssText = 'font-size:11px;color:var(--text-muted);padding:4px 2px';
      hint.textContent = 'åœ¨ç”»å»Šæ”¶è—å­—ä½“åæ˜¾ç¤ºäºæ­¤';
      favFontRow.appendChild(hint);
    } else {
      favFonts.forEach(f=>{
        const btn = document.createElement('button');
        btn.className = 'font-btn' + (modalState.fontFamily===f.family ? ' active' : '');
        btn.style.fontFamily = f.family;
        btn.dataset.family = f.family;
        btn.textContent = f.name;
        btn.onclick = ()=>{ modalState.fontFamily=f.family; body.style.fontFamily=f.family; saveFont(f.family); updateFontBtns(footer, modalState); };
        favFontRow.appendChild(btn);
      });
    }
    favFontSection.appendChild(favFontRow);
    footer.appendChild(favFontSection);

    const copyBtn = document.createElement('button');
    copyBtn.className = 'copy-css-btn';
    copyBtn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>å¤åˆ¶ CSS ä»£ç `;
    copyBtn.onclick = ()=>copyText(item.css, 'CSS');
    footer.appendChild(copyBtn);

  } else {
    document.getElementById('dbs').textContent = '';

    const box = document.createElement('div');
    box.className = 'font-preview-box';
    box.innerHTML = `
      <div class="font-big" style="font-family:${item.family}">å­—ä½“é¢„è§ˆ<br>æˆ‘è®¸æ„¿ä¸€ä¸ªæœ‰ä½ çš„å†¬å¤©</div>
      <div class="font-small" style="font-family:${item.family}">æˆ‘å››å­£éƒ½åœ¨<br>Aa Bb Cc 123</div>
      <div class="font-chars" style="font-family:${item.family}">æ°¸è¿œ çˆ±ä½  æ€å¿µ</div>
    `;
    body.appendChild(box);

    const copyBtn = document.createElement('button');
    copyBtn.className = 'copy-css-btn';
    copyBtn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>å¤åˆ¶å­—ä½“é“¾æ¥`;
    copyBtn.onclick = ()=>copyText(item.url, 'å­—ä½“é“¾æ¥');
    footer.appendChild(copyBtn);
  }

  backdrop.classList.add('open');
  document.body.style.overflow = 'hidden';
}

function updateFontBtns(footer, modalState){
  footer.querySelectorAll('.font-btn').forEach(btn=>{
    const fam = btn.dataset.family || '';
    btn.classList.toggle('active', fam === modalState.fontFamily);
  });
}

function closeModal(){
  document.getElementById('modal-backdrop').classList.remove('open');
  document.body.style.overflow = '';
  currentModalItem = null;
  setTimeout(()=>{ document.getElementById('dbs').textContent=''; }, 350);
}

document.getElementById('modal-close').addEventListener('click', closeModal);
document.getElementById('modal-backdrop').addEventListener('click', function(e){ if(e.target===this) closeModal(); });

let touchStartY = 0;
document.getElementById('modal').addEventListener('touchstart', e=>{ touchStartY = e.touches[0].clientY; }, {passive:true});
document.getElementById('modal').addEventListener('touchend', e=>{ if(e.changedTouches[0].clientY - touchStartY > 80) closeModal(); }, {passive:true});
document.addEventListener('keydown', e=>{ if(e.key==='Escape') closeModal(); });

function setType(t){
  state.type = t;
  ['type-list','m-type-list'].forEach(id=>{
    const list = document.getElementById(id);
    if(!list) return;
    list.querySelectorAll('.type-pill').forEach(p=>p.classList.toggle('active', p.dataset.type===t));
  });
  renderCards();
}

function setAuthor(a){
  state.author = a;
  renderAuthors();
  renderCards();
}

['type-list','m-type-list'].forEach(id=>{
  const list = document.getElementById(id);
  if(!list) return;
  list.querySelectorAll('.type-pill').forEach(pill=>{
    pill.addEventListener('click', ()=>setType(pill.dataset.type));
  });
});

document.getElementById('search-input').addEventListener('input', function(){
  state.query = this.value.trim();
  renderCards();
});

document.querySelectorAll('.nav-btn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const tab = btn.dataset.tab;
    const gv = document.getElementById('gallery-view');
    const sv = document.getElementById('submit-view');
    if(tab==='gallery'){ gv.style.display='flex'; sv.classList.remove('active'); }
    else { gv.style.display='none'; sv.classList.add('active'); }
  });
});

document.getElementById('mobile-filter-btn').addEventListener('click', ()=>{ document.getElementById('filter-drawer').classList.add('open'); });
document.getElementById('filter-drawer-bg').addEventListener('click', ()=>{ document.getElementById('filter-drawer').classList.remove('open'); });

const SUBMIT_EMAIL = '3152037224@qq.com';

window.switchForm = function(type){
  document.querySelectorAll('.form-panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.s-type-btn').forEach((b,i)=>b.classList.toggle('active',(type==='bubble'&&i===0)||(type==='font'&&i===1)));
  document.getElementById('form-'+type).classList.add('active');
  document.getElementById('fallback-bubble').classList.remove('show');
  document.getElementById('fallback-font').classList.remove('show');
};

function buildBubbleCode(name, author, css, demos){
  const tagMap = ['sent','received','sent','received'];
  const prevStr = demos.filter(d=>d.v).map(d=>`    {t:'${d.t}',v:'${d.v.replace(/'/g,"\\'")}'}` ).join(',\n');
  const nextId = 'b' + (BUBBLES.length + 1);
  return `/* === æ°”æ³¡æŠ•ç¨¿ === */\n{\n  id:'${nextId}',\n  type:'bubble',\n  name:'${name}',\n  author:'${author||'åŒ¿å'}',\n  previews:[\n${prevStr}\n  ],\n  css:\`${css}\`\n}`;
}

function buildFontCode(name, author, url, category){
  const nextId = 'f' + (FONTS.length + 1);
  const nextFamily = 'F' + (FONTS.length + 1);
  return `/* === å­—ä½“æŠ•ç¨¿ === */\n/* 1. åœ¨ @font-face æ·»åŠ : */\n@font-face { font-family:'${nextFamily}'; src:url('${url}') format('truetype'); font-display:swap }\n\n/* 2. åœ¨ FONTS æ•°ç»„æ·»åŠ : */\n{\n  id:'${nextId}',\n  type:'font',\n  name:'${name}',\n  author:'${author||'åŒ¿å'}',\n  family:'${nextFamily}',\n  category:'${category||'å…¶ä»–'}',\n  url:'${url}'\n}\n\n/* æ³¨æ„ï¼šæ–°å­—ä½“éœ€ç”¨æˆ·åœ¨ç”»å»Šæ”¶è—åæ‰ä¼šæ˜¾ç¤ºåœ¨é¢„è§ˆå­—ä½“åˆ‡æ¢çš„"å·²æ”¶è—"åŒºåŸŸ */`;
}

window.doSubmit = function(type){
  const nl = '\r\n';
  let subject='', body='', code='';

  if(type==='bubble'){
    const name   = document.getElementById('bubble-name').value.trim();
    const author = document.getElementById('bubble-author').value.trim();
    const css    = document.getElementById('bubble-css').value.trim();
    const demos  = [1,2,3,4].map((n,i)=>({ t:['sent','received','sent','received'][i], v:document.getElementById('p'+n).value.trim() }));
    if(!name || !css){ toast('âš ï¸ è¯·å¡«å†™åç§°å’Œ CSS ä»£ç '); return; }

    code = buildBubbleCode(name, author, css, demos);
    subject = `ã€æ°”æ³¡æŠ•ç¨¿ã€‘${name} - ${author||'åŒ¿å'}`;
    body = `æŠ•ç¨¿ç±»å‹ï¼šèŠå¤©æ°”æ³¡${nl}åç§°ï¼š${name}${nl}ä½œè€…ï¼š${author||'åŒ¿å'}${nl}${nl}--- å¯ç›´æ¥ç²˜è´´åˆ°ä»£ç çš„æ•°æ®æ¡ç›® ---${nl}${code}`;

    document.getElementById('fb-content-bubble').value = `æ”¶ä»¶äºº: ${SUBMIT_EMAIL}\nä¸»é¢˜: ${subject}\n\n${body}`;
    document.getElementById('fallback-bubble').classList.add('show');

  } else {
    const name   = document.getElementById('font-name').value.trim();
    const author = document.getElementById('font-author').value.trim();
    const url    = document.getElementById('font-url').value.trim();
    const cat    = document.getElementById('font-category').value;
    if(!name || !url){ toast('âš ï¸ è¯·å¡«å†™åç§°å’Œå­—ä½“é“¾æ¥'); return; }

    code = buildFontCode(name, author, url, cat);
    subject = `ã€å­—ä½“æŠ•ç¨¿ã€‘${name} - ${author||'åŒ¿å'}`;
    body = `æŠ•ç¨¿ç±»å‹ï¼šå­—ä½“æ ·å¼${nl}åç§°ï¼š${name}${nl}ä½œè€…ï¼š${author||'åŒ¿å'}${nl}åˆ†ç±»ï¼š${cat}${nl}${nl}--- å¯ç›´æ¥ç²˜è´´åˆ°ä»£ç çš„æ•°æ®æ¡ç›® ---${nl}${code}`;

    document.getElementById('fb-content-font').value = `æ”¶ä»¶äºº: ${SUBMIT_EMAIL}\nä¸»é¢˜: ${subject}\n\n${body}`;
    document.getElementById('fallback-font').classList.add('show');
  }

  window.location.href = `mailto:${SUBMIT_EMAIL}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
  setTimeout(()=> toast('ğŸš€ æ­£åœ¨å”¤èµ·é‚®ä»¶å®¢æˆ·ç«¯ï¼Œå¦‚æœªå¼¹å‡ºè¯·ä½¿ç”¨ä¸‹æ–¹æ‰‹åŠ¨å‘é€'), 400);
};

window.copyFallback = function(type){
  const el = document.getElementById('fb-content-'+type);
  copyText(el.value, 'æŠ•ç¨¿å†…å®¹');
};

window.copyEmail = function(type){
  copyText(SUBMIT_EMAIL, 'æ”¶ä»¶åœ°å€');
};
updateFavCounts();
renderAuthors();
renderCards();

})();
</script>
</body>
</html>