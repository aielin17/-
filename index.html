<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Style Gallery Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --bg-color: #f2f2f7;
            --surface-color: #ffffff;
            --text-main: #000000;
            --text-sub: #8e8e93;
            --border-color: #e5e5ea;
            --accent-color: #007aff;
            --accent-hover: #0063ce;
            --card-radius: 16px;
            --safe-inset: env(safe-area-inset-top, 0px);
        }

        @font-face {
            font-family: 'CustomFont1';
            src: url('https://files.catbox.moe/kmyipl.TTF') format('truetype');
            font-display: swap;
        }
        @font-face {
            font-family: 'CustomFont2';
            src: url('https://image.uglycat.cc/6wapca.ttf') format('truetype');
            font-display: swap;
        }
        @font-face {
            font-family: 'CustomFont3';
            src: url('https://files.catbox.moe/3bm8wp.ttf') format('truetype');
            font-display: swap;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            line-height: 1.5;
        }

        /* --- Header --- */
        header {
            background: rgba(255, 255, 255, 0.85);
            border-bottom: 1px solid rgba(0,0,0,0.1);
            padding: 0 20px;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            z-index: 100;
        }

        .brand {
            font-weight: 700;
            font-size: 20px;
            letter-spacing: -0.5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .brand svg { width: 24px; height: 24px; }

        .nav-tabs {
            display: flex;
            gap: 8px;
            background: #e9e9eb;
            padding: 4px;
            border-radius: 10px;
        }

        .nav-item {
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-main);
            padding: 6px 16px;
            border-radius: 7px;
            transition: all 0.2s;
        }

        .nav-item.active {
            background: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* --- Layout --- */
        .view {
            flex: 1;
            display: flex;
            overflow: hidden;
            position: relative;
        }

        .gallery-view {
            width: 100%;
            display: flex;
            flex-direction: row;
        }

        /* --- Sidebar / Gallery List --- */
        .gallery-panel {
            width: 380px;
            min-width: 300px;
            background: var(--surface-color);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            padding: 24px 20px;
            display: flex;
            flex-direction: column;
            gap: 36px;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .section-title {
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-sub);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-card {
            border: 1px solid var(--border-color);
            border-radius: var(--card-radius);
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            background: #fff;
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .option-card:hover {
            border-color: #bbb;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .option-card.selected {
            border-color: var(--accent-color);
            background-color: #f0f7ff;
            box-shadow: 0 0 0 1px var(--accent-color);
        }

        .card-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .card-name {
            font-size: 16px;
            font-weight: 600;
        }

        .card-author {
            font-size: 12px;
            color: var(--text-sub);
            display: inline-block;
            background: rgba(0,0,0,0.04);
            padding: 2px 8px;
            border-radius: 6px;
            width: fit-content;
        }

        .card-actions {
            display: flex;
            gap: 8px;
        }

        .btn-copy-card {
            background: #fff;
            border: 1px solid var(--border-color);
            color: var(--text-main);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            z-index: 2;
        }
        .btn-copy-card:hover {
            background: #f2f2f7;
            transform: scale(1.05);
        }
        .btn-copy-card:active {
            transform: scale(0.95);
            background: #e5e5ea;
        }
        .btn-copy-card svg {
            width: 16px;
            height: 16px;
            stroke-width: 2.5;
        }

        /* --- Preview Area --- */
        .preview-panel {
            flex: 1;
            background: #f2f2f7;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background-image: radial-gradient(#d1d1d6 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .chat-window {
            width: min(390px, 90vw);
            height: min(844px, 90vh);
            background: #fff;
            border-radius: 40px;
            box-shadow: 0 40px 80px -20px rgba(0,0,0,0.15), 0 0 0 10px #ffffff;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .chat-header {
            padding: 18px 16px;
            border-bottom: 1px solid #f0f0f0;
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(10px);
            text-align: center;
            font-weight: 600;
            font-size: 16px;
            z-index: 10;
        }

        .chat-body {
            flex: 1;
            padding: 20px 16px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow-y: auto;
            background: #fff;
            font-family: inherit;
        }

        /* --- Bubble Base Styles --- */
        .message-wrapper {
            display: flex;
            width: 100%;
        }
        .message-wrapper.sent { justify-content: flex-end; }
        .message-wrapper.received { justify-content: flex-start; }

        .message {
            max-width: 80%;
            font-size: 16px;
            padding: 10px 16px;
            background: #e5e5ea;
            border-radius: 18px;
            word-break: break-word;
        }

        /* --- Submission View --- */
        .submit-view {
            display: none;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            background-color: var(--bg-color);
            padding: 32px 16px;
            align-items: flex-start;
            justify-content: center;
        }
        .submit-view.active { display: flex; }

        .submit-container {
            width: 100%;
            max-width: 600px;
            background: var(--surface-color);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.06);
            margin-bottom: 40px; /* Space for scroll */
        }

        .submit-header {
            text-align: center;
            margin-bottom: 32px;
        }
        .submit-header h2 { font-size: 24px; margin-bottom: 8px; }
        .submit-header p { color: var(--text-sub); font-size: 14px; }

        .submit-type-selector {
            display: flex;
            gap: 16px;
            margin-bottom: 32px;
            justify-content: center;
        }

        .type-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid var(--border-color);
            background: transparent;
            border-radius: 12px;
            font-weight: 600;
            font-size: 15px;
            color: var(--text-sub);
            cursor: pointer;
            transition: 0.2s;
        }
        .type-btn.active {
            border-color: var(--accent-color);
            color: var(--accent-color);
            background: rgba(0, 122, 255, 0.05);
        }

        .form-panel { display: none; animation: fadeIn 0.3s ease; }
        .form-panel.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .form-group { margin-bottom: 24px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px; color: #333; }
        .form-sub-label { display: block; margin-bottom: 8px; font-size: 12px; color: #888; margin-top: -4px; }
        
        .form-input, .form-textarea {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            font-size: 15px;
            background: #f9f9f9;
            transition: 0.2s;
            font-family: inherit;
        }
        .form-textarea { height: 160px; font-family: 'Menlo', 'Monaco', monospace; font-size: 13px; line-height: 1.4; resize: vertical; }
        .form-input:focus, .form-textarea:focus {
            border-color: var(--accent-color);
            background: #fff;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        /* New Style for Preview Inputs Column */
        .preview-inputs-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            background: #f2f2f7;
            padding: 16px;
            border-radius: 16px;
        }
        .preview-input-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .preview-tag {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-sub);
            width: 30px;
            text-align: right;
        }
        .preview-input-row input {
            background: #fff;
            border: 1px solid var(--border-color);
        }

        .btn-submit {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .btn-submit:hover { background: var(--accent-hover); }

        /* --- Toast Notification --- */
        #toast {
            visibility: hidden;
            min-width: 250px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 50px;
            padding: 12px 24px;
            position: fixed;
            z-index: 1000;
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%);
            font-size: 14px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            opacity: 0;
            transition: opacity 0.3s, bottom 0.3s;
        }
        #toast.show {
            visibility: visible;
            opacity: 1;
            bottom: 40px;
        }

        /* --- Media Queries --- */
        @media (max-width: 820px) {
            .gallery-view { flex-direction: column; }
            .gallery-panel {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
                height: 40vh;
                min-height: 300px;
                padding: 16px;
            }
            .preview-panel { min-height: 60vh; padding: 10px; }
            .chat-window { width: 100%; height: 100%; border-radius: 28px; }
            .submit-container { padding: 24px; border-radius: 20px; }
        }

        #dynamic-bubble-style { display: none; }
    </style>
    <style id="dynamic-bubble-style"></style>
</head>
<body>

<header>
    <div class="brand">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
        <span>Style Gallery</span>
    </div>
    <div class="nav-tabs">
        <div class="nav-item active" data-tab="gallery">ÁîªÂªä</div>
        <div class="nav-item" data-tab="submit">ÊäïÁ®ø</div>
    </div>
</header>

<!-- Gallery View -->
<div id="gallery-view" class="view gallery-view">
    <aside class="gallery-panel">
        
        <!-- Bubble Section -->
        <div>
            <div class="section-header">
                <div class="section-title">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg> 
                    ËÅäÂ§©Ê∞îÊ≥°
                </div>
            </div>
            <div class="card-grid" id="bubble-list">
                <!-- JS will inject cards here -->
            </div>
        </div>

        <!-- Font Section -->
        <div>
            <div class="section-header">
                <div class="section-title">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 7V4h16v3M9 20h6M12 4v16"/></svg> 
                    Â≠ó‰ΩìÊ†∑Âºè
                </div>
            </div>
            <div class="card-grid" id="font-list">
                <!-- JS will inject cards here -->
            </div>
        </div>

    </aside>

    <section class="preview-panel">
        <div class="chat-window">
            <div class="chat-header">È¢ÑËßà ¬∑ Áã¨Á´ãÊ∂àÊÅØ</div>
            <div class="chat-body" id="preview-body"></div>
        </div>
    </section>
</div>

<!-- Submit View -->
<div id="submit-view" class="view submit-view">
    <div class="submit-container">
        <div class="submit-header">
            <h2>Êèê‰∫§‰Ω†ÁöÑÂàõÊÑè</h2>
            <p>ÈÄâÊã©Á±ªÂûãÔºåÂ°´ÂÜô‰ø°ÊÅØÔºåÂî§Ëµ∑ÈÇÆ‰ª∂ÂÆ¢Êà∑Á´ØÂèëÈÄÅ</p>
        </div>

        <div class="submit-type-selector">
            <button class="type-btn active" onclick="switchForm('bubble')">Ê∞îÊ≥°ÊäïÁ®ø</button>
            <button class="type-btn" onclick="switchForm('font')">Â≠ó‰ΩìÊäïÁ®ø</button>
        </div>

        <!-- Bubble Form -->
        <div class="form-panel active" id="form-bubble">
            <div class="form-group">
                <label class="form-label">Ê∞îÊ≥°ÂêçÁß∞</label>
                <input type="text" class="form-input" placeholder="Áªô‰Ω†ÁöÑÊ∞îÊ≥°Ëµ∑‰∏™ÂêçÂ≠ó" id="bubble-name">
            </div>
            <div class="form-group">
                <label class="form-label">‰ΩúËÄÖÁΩ≤Âêç</label>
                <input type="text" class="form-input" placeholder="Â±ïÁ§∫Áî®ÁöÑÊòµÁß∞" id="bubble-author">
            </div>
            <div class="form-group">
                <label class="form-label">CSS ‰ª£Á†Å</label>
                <span class="form-sub-label">ÈúÄÂåÖÂê´ .message-sent Âíå .message-received Á±ª</span>
                <textarea class="form-textarea" placeholder=".message-sent { ... }" id="bubble-css"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">È¢ÑËßàÂØπËØù (2~4Êù°)</label>
                <span class="form-sub-label">Âª∫ËÆÆÂ°´ÂÜô‰∏ÄÈóÆ‰∏ÄÁ≠îÔºåÁïôÁ©∫Âàô‰∏çÊèê‰∫§ËØ•Ë°å</span>
                <div class="preview-inputs-container">
                    <div class="preview-input-row">
                        <span class="preview-tag">ÂèëÈÄÅ</span>
                        <input type="text" class="form-input" id="bubble-demo-1" placeholder="Á¨¨‰∏ÄÊù°Ê∂àÊÅØ">
                    </div>
                    <div class="preview-input-row">
                        <span class="preview-tag">Êé•Êî∂</span>
                        <input type="text" class="form-input" id="bubble-demo-2" placeholder="Á¨¨‰∫åÊù°Ê∂àÊÅØ">
                    </div>
                    <div class="preview-input-row">
                        <span class="preview-tag">ÂèëÈÄÅ</span>
                        <input type="text" class="form-input" id="bubble-demo-3" placeholder="Á¨¨‰∏âÊù°Ê∂àÊÅØ (ÂèØÈÄâ)">
                    </div>
                    <div class="preview-input-row">
                        <span class="preview-tag">Êé•Êî∂</span>
                        <input type="text" class="form-input" id="bubble-demo-4" placeholder="Á¨¨ÂõõÊù°Ê∂àÊÅØ (ÂèØÈÄâ)">
                    </div>
                </div>
            </div>
            <button class="btn-submit" onclick="submitToEmail('bubble')">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                Âî§Ëµ∑ÈÇÆ‰ª∂ÂÆ¢Êà∑Á´ØÂèëÈÄÅ
            </button>
        </div>

        <!-- Font Form -->
        <div class="form-panel" id="form-font">
            <div class="form-group">
                <label class="form-label">Â≠ó‰ΩìÂêçÁß∞</label>
                <input type="text" class="form-input" placeholder="Â≠ó‰ΩìÂêç" id="font-name">
            </div>
            <div class="form-group">
                <label class="form-label">‰ΩúËÄÖÁΩ≤Âêç</label>
                <input type="text" class="form-input" placeholder="ÊòµÁß∞" id="font-author">
            </div>
            <div class="form-group">
                <label class="form-label">@font-face ‰ª£Á†Å</label>
                <span class="form-sub-label">ËØ∑Êèê‰æõÂÆåÊï¥ÁöÑ font-face ÂÆö‰πâÂèä URL</span>
                <textarea class="form-textarea" placeholder="@font-face { font-family: '...'; src: url('...'); }" id="font-css"></textarea>
            </div>
            <button class="btn-submit" onclick="submitToEmail('font')">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                Âî§Ëµ∑ÈÇÆ‰ª∂ÂÆ¢Êà∑Á´ØÂèëÈÄÅ
            </button>
        </div>
    </div>
</div>

<!-- Toast Notification -->
<div id="toast">Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø</div>

<script>
    (function() {
        // --- Data ---
        // Ê≥®ÊÑèÔºöfontÂØπË±°‰∏≠Â¢ûÂä†‰∫Ü url Â≠óÊÆµÔºåÁî®‰∫éÂ§çÂà∂
        const fonts = [
            { 
                name: "‰∫¨Âçé‰Ωì", id: "font1", family: "CustomFont1", author: "milk",
                url: "https://files.catbox.moe/kmyipl.TTF",
                css: "@font-face {\n  font-family: 'CustomFont1';\n  src: url('https://files.catbox.moe/kmyipl.TTF') format('truetype');\n  font-display: swap;\n}"
            },
            { 
                name: "ÊóßÊ¨æÂÜ¨", id: "font2", family: "CustomFont2", author: "ËÆ®ÂéåÈ¶ôËèú",
                url: "https://image.uglycat.cc/6wapca.ttf",
                css: "@font-face {\n  font-family: 'CustomFont2';\n  src: url('https://image.uglycat.cc/6wapca.ttf') format('truetype');\n  font-display: swap;\n}"
            },
            { 
                name: "ÊàëÊúâ‰∏ÄÁÇπÊÉ≥‰Ω†", id: "font3", family: "CustomFont3", author: "ËÄÅÁå´",
                url: "https://files.catbox.moe/3bm8wp.ttf",
                css: "@font-face {\n  font-family: 'CustomFont3';\n  src: url('https://files.catbox.moe/3bm8wp.ttf') format('truetype');\n  font-display: swap;\n}"
            }
        ];

        const bubbles = [
            {
                name: "ÂÆùË¥ùÊàëÊó†ËØ≠‰∫Ü", author: "Áú†Áú†",
                previews: [
                    { type: 'sent', text: 'ÊàëÂØπËá™Â∑±ÁöÑÊàêÂäüÂæàÊª°ÊÑè' },
                    { type: 'received', text: '‰Ω†Ê≤°Êúâ‰Ω†ÊÉ≥Ë±°ÁöÑÈÇ£‰πàÈÅ≠' }
                ],
                css: `.message {
    box-shadow: none !important;
    border-width: 0 !important;
    font-weight: 500 !important;
    position: relative;
    overflow: visible !important;
}
.message::after {
    content: '' !important;
    position: absolute !important;
    width: 0 !important;
    height: 0 !important;
    border-style: solid !important;
    filter: drop-shadow(1px 1px 2px rgba(0, 0, 0, 0.08));
}
.message.message-sent::after {
    bottom: 10px !important;
    right: -5px !important;
    border-width: 4px 0 0 5px !important;
    border-color: transparent transparent transparent #F8F8F8 !important;
    filter: drop-shadow(1px 1px 2px rgba(0, 0, 0, 0.1));
}
.message.message-received::after {
    bottom: 10px !important;
    left: -5px !important;
    border-width: 0 0 4px 5px !important;
    border-color: transparent transparent #FFFFFF transparent !important;
    filter: drop-shadow(1px 1px 2px rgba(0, 0, 0, 0.1));
}
.message-sent::before {
    content: "‚Ä¢‚Ä¢‚Ä¢" !important;
    position: absolute !important;
    top: -18px !important;
    left: -15px !important;
    font-size: 6px !important;
    letter-spacing: 0.8px !important;
    color: #444444 !important;
    background: #F8F8F8 !important;
    padding: 3px 7px !important;
    border-radius: 12px 8px 8px 12px !important;
    line-height: 1 !important;
    font-weight: 800 !important;
    text-align: center !important;
    box-shadow: 
        -2px -2px 4px rgba(255, 255, 255, 0.9),
        3px 3px 6px rgba(160, 160, 160, 0.3),
        inset 1px 1px 2px rgba(255, 255, 255, 0.8),
        inset -1px -1px 2px rgba(0, 0, 0, 0.03) !important;
    z-index: 3 !important;
    transition: all 0.2s ease;
}
.message-received::before {
    content: "‚ô•Ô∏é+520" !important;
    position: absolute !important;
    top: -12px !important;
    right: -35px !important;
    font-size: 7px !important;
    letter-spacing: 0.4px !important;
    color: #F1BFCB !important;  
    background: #FFFFFF !important;
    padding: 3px 6px !important;
    border-radius: 6px 10px 10px 6px !important;
    line-height: 1 !important;
    font-weight: 500 !important;
    text-align: center !important;
    white-space: nowrap !important;
    box-shadow: 
        -2px -2px 4px rgba(255, 255, 255, 0.9),
        3px 3px 5px rgba(180, 180, 180, 0.2),
        inset 1px 1px 2px rgba(255, 255, 255, 0.8),
        inset -1px -1px 2px rgba(0, 0, 0, 0.02) !important;
    z-index: 3 !important;
    transition: all 0.2s ease;
}
.message-received {
    background: #FFFFFF !important;
    border-color: transparent !important;
    color: #000000 !important;
    border-radius: 24px 24px 24px 4px !important;
    padding: 8px 16px !important;
    box-shadow: 
        -3px -3px 6px rgba(255, 255, 255, 0.8),
        4px 4px 8px rgba(180, 180, 180, 0.25),
        inset 2px 2px 4px rgba(255, 255, 255, 0.9),
        inset -2px -2px 4px rgba(0, 0, 0, 0.05) !important;
    position: relative;
    transition: all 0.2s ease;
}
.message-received:active {
    box-shadow: 
        -2px -2px 4px rgba(255, 255, 255, 0.8),
        2px 2px 4px rgba(180, 180, 180, 0.25),
        inset 3px 3px 6px rgba(0, 0, 0, 0.05),
        inset -3px -3px 6px rgba(255, 255, 255, 0.9) !important;
}
.message-sent {
    background: #F8F8F8 !important;
    border-color: transparent !important;
    color: #000000 !important;
    border-radius: 24px 24px 4px 24px !important;
    padding: 8px 16px !important;
    box-shadow: 
        -4px -4px 8px rgba(255, 255, 255, 0.9),
        5px 5px 10px rgba(150, 150, 150, 0.2),
        inset 2px 2px 4px rgba(255, 255, 255, 0.9),
        inset -2px -2px 4px rgba(0, 0, 0, 0.03) !important;
    position: relative;
    transition: all 0.2s ease;
    background-image: radial-gradient(circle at 35% 35%, rgba(255, 255, 255, 0.5) 0%, #F8F8F8 70%) !important;
}
.message-sent:active {
    box-shadow: 
        -2px -2px 4px rgba(255, 255, 255, 0.9),
        3px 3px 6px rgba(150, 150, 150, 0.2),
        inset 3px 3px 6px rgba(0, 0, 0, 0.03),
        inset -3px -3px 6px rgba(255, 255, 255, 0.9) !important;
}`
            },
            {
                name: "Â∞èÂ∞æÂ∑¥", author: "milk",
                previews: [
                    { type: 'sent', text: 'ÂèØÊòØÊàë‰∏çËßâÂæóÊàëÁà±‰Ω†' },
                    { type: 'received', text: 'ÈÇ£‰Ω†Ê≠§ÂàªÊÑøÊÑèÂêëÊàëÊïûÂºÄÂøÉÊââÂêóÔºü' },
                    { type: 'sent', text: 'ÊÑøÊÑè„ÄÇ' },
                    { type: 'received', text: 'ÊàëÁöÑËç£Âπ∏„ÄÇ' }
                ],
                css: `.message {
  box-shadow: none !important;
  border-width: 0 !important;
  font-weight: 500 !important;
  position: relative !important;
  overflow: visible !important;
}
.message {
  padding: 7px 13px !important;
  line-height: 1.3 !important;
  word-break: break-word !important;
  border-radius: 18px !important;
  box-shadow: 0 2px 3px rgba(0, 0, 0, 0.1) !important;
}
.message-received {
  background: #ffffff !important;
  border-color: transparent !important;
  color: #000000 !important;
  border-radius: 24px 24px 24px 4px !important;
  padding: 8px 16px !important;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15) !important;
}
.message-sent {
  background: #ffe8ec !important;
  border-color: transparent !important;
  color: #000000 !important;
  border-radius: 24px 24px 4px 24px !important;
  padding: 8px 16px !important;
  box-shadow: 0 4px 8px rgba(180, 120, 140, 0.3) !important;
}
.message::after {
  content: '' !important;
  position: absolute !important;
  width: 30px !important;
  height: 15px !important;
  background-size: contain !important;
  background-repeat: no-repeat !important;
  z-index: 0 !important;
}
.message.message-sent::after {
  bottom: -4.1px !important;
  right: -19px !important;
  background-image: url('https://files.catbox.moe/pe52nt.png') !important;
  filter: drop-shadow(5.2px 4.1px 5px rgba(180, 120, 140, 0.4)) !important; 
}
.message.message-received::after {
  bottom: -3.9px !important;
  left: -6.6px !important;
  background-image: url('https://files.catbox.moe/9exvg6.png') !important;
  filter: drop-shadow(-3px 5px 4px rgba(0, 0, 0, 0.2)) !important;
}`
            }
        ];

        let currentBubble = 0;
        let currentFont = 0;

        // --- Core Functions ---

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'show';
            setTimeout(function(){ toast.className = toast.className.replace('show', ''); }, 3000);
        }

        function copyContent(text, label) {
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).then(() => {
                    showToast(`‚úÖ Â∑≤Â§çÂà∂ ${label}`);
                });
            } else {
                const textArea = document.createElement("textarea");
                textArea.value = text;
                textArea.style.position = "fixed";
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    document.execCommand('copy');
                    showToast(`‚úÖ Â∑≤Â§çÂà∂ ${label}`);
                } catch (err) {
                    showToast('‚ùå Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂');
                }
                document.body.removeChild(textArea);
            }
        }

        function renderBubbleList() {
            const container = document.getElementById('bubble-list');
            container.innerHTML = '';
            bubbles.forEach((b, i) => {
                const card = document.createElement('div');
                card.className = `option-card ${i === currentBubble ? 'selected' : ''}`;
                
                // Select Bubble
                card.onclick = (e) => {
                    if(e.target.closest('.btn-copy-card')) return;
                    currentBubble = i;
                    applyBubble();
                    renderBubbleList();
                    renderPreview();
                };

                card.innerHTML = `
                    <div class="card-info">
                        <span class="card-name">${b.name}</span>
                        <span class="card-author">${b.author}</span>
                    </div>
                    <div class="card-actions">
                        <div class="btn-copy-card" title="Â§çÂà∂CSS‰ª£Á†Å">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                        </div>
                    </div>
                `;

                // Copy Button Logic (Full CSS)
                const copyBtn = card.querySelector('.btn-copy-card');
                copyBtn.onclick = (e) => {
                    e.stopPropagation();
                    copyContent(b.css, 'Ê∞îÊ≥°CSS');
                };

                container.appendChild(card);
            });
        }

        function renderFontList() {
            const container = document.getElementById('font-list');
            container.innerHTML = '';
            fonts.forEach((f, i) => {
                const card = document.createElement('div');
                card.className = `option-card ${i === currentFont ? 'selected' : ''}`;
                
                // Select Font
                card.onclick = (e) => {
                    if(e.target.closest('.btn-copy-card')) return;
                    currentFont = i;
                    applyFont();
                    renderFontList();
                };

                card.innerHTML = `
                    <div class="card-info">
                        <span class="card-name" style="font-family:${f.family}">${f.name}</span>
                        <span class="card-author">${f.author}</span>
                    </div>
                    <div class="card-actions">
                        <div class="btn-copy-card" title="Â§çÂà∂Â≠ó‰ΩìÈìæÊé•">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>
                        </div>
                    </div>
                `;

                // Copy Button Logic (URL Only)
                const copyBtn = card.querySelector('.btn-copy-card');
                copyBtn.onclick = (e) => {
                    e.stopPropagation();
                    // ËøôÈáå‰ΩøÁî®ÁöÑÊòØ f.url ËÄå‰∏çÊòØ f.css
                    copyContent(f.url, 'Â≠ó‰ΩìÈìæÊé•');
                };

                container.appendChild(card);
            });
        }

        function applyBubble() {
            const styleTag = document.getElementById('dynamic-bubble-style');
            styleTag.innerHTML = bubbles[currentBubble].css;
        }

        function applyFont() {
            const family = fonts[currentFont].family;
            document.querySelector('.chat-window').style.fontFamily = family;
            document.getElementById('preview-body').style.fontFamily = family;
        }

        function renderPreview() {
            const body = document.getElementById('preview-body');
            body.innerHTML = '';
            const msgs = bubbles[currentBubble].previews || [
                { type: 'sent', text: 'Hello!' }, { type: 'received', text: 'Hi there.' }
            ];
            msgs.forEach(msg => {
                const wrapper = document.createElement('div');
                wrapper.className = `message-wrapper ${msg.type}`;
                const bubble = document.createElement('div');
                bubble.className = `message message-${msg.type}`;
                bubble.textContent = msg.text;
                wrapper.appendChild(bubble);
                body.appendChild(wrapper);
            });
        }

        // --- Navigation ---
        window.switchForm = function(type) {
            document.querySelectorAll('.form-panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`form-${type}`).classList.add('active');
            const btns = document.querySelectorAll('.type-btn');
            if(type === 'bubble') btns[0].classList.add('active');
            else btns[1].classList.add('active');
        };

        const navItems = document.querySelectorAll('.nav-item');
        navItems.forEach(item => {
            item.addEventListener('click', () => {
                navItems.forEach(n => n.classList.remove('active'));
                item.classList.add('active');
                
                const tab = item.dataset.tab;
                document.getElementById('gallery-view').style.display = tab === 'gallery' ? 'flex' : 'none';
                
                const submitView = document.getElementById('submit-view');
                if (tab === 'submit') {
                    submitView.classList.add('active');
                } else {
                    submitView.classList.remove('active');
                }
            });
        });

        // --- Submission Logic ---
        window.submitToEmail = function(type) {
            const myEmail = "3152037224@qq.com";
            let subject = "";
            let body = "";

            if (type === 'bubble') {
                const name = document.getElementById('bubble-name').value.trim();
                const author = document.getElementById('bubble-author').value.trim();
                const css = document.getElementById('bubble-css').value.trim();
                
                // Ëé∑Âèñ4Êù°È¢ÑËßàËæìÂÖ•
                const demo1 = document.getElementById('bubble-demo-1').value.trim();
                const demo2 = document.getElementById('bubble-demo-2').value.trim();
                const demo3 = document.getElementById('bubble-demo-3').value.trim();
                const demo4 = document.getElementById('bubble-demo-4').value.trim();

                // ÁªÑÂêàÈùûÁ©∫ÁöÑÈ¢ÑËßàÊñáÊ°à
                let demoText = "";
                if(demo1) demoText += `1. (ÂèëÈÄÅ) ${demo1}\n`;
                if(demo2) demoText += `2. (Êé•Êî∂) ${demo2}\n`;
                if(demo3) demoText += `3. (ÂèëÈÄÅ) ${demo3}\n`;
                if(demo4) demoText += `4. (Êé•Êî∂) ${demo4}\n`;
                if(!demoText) demoText = "ÔºàÊú™Â°´ÂÜôÈ¢ÑËßàÊñáÊ°àÔºâ";

                if(!name || !css) { showToast('‚ö†Ô∏è ËØ∑Ëá≥Â∞ëÂ°´ÂÜôÂêçÁß∞ÂíåCSS‰ª£Á†Å'); return; }

                subject = `„ÄêÊ∞îÊ≥°ÊäïÁ®ø„Äë${name} - ${author || 'ÂåøÂêç'}`;
                body = `ÊäïÁ®øÁ±ªÂûãÔºöËÅäÂ§©Ê∞îÊ≥°\nÂêçÁß∞Ôºö${name}\n‰ΩúËÄÖÔºö${author}\n\nCSS ‰ª£Á†ÅÔºö\n${css}\n\nÈ¢ÑËßàÂØπËØùÊñáÊ°àÔºö\n${demoText}`;
            } 
            else if (type === 'font') {
                const name = document.getElementById('font-name').value.trim();
                const author = document.getElementById('font-author').value.trim();
                const css = document.getElementById('font-css').value.trim();

                if(!name || !css) { showToast('‚ö†Ô∏è ËØ∑Ëá≥Â∞ëÂ°´ÂÜôÂêçÁß∞ÂíåCSS‰ª£Á†Å'); return; }

                subject = `„ÄêÂ≠ó‰ΩìÊäïÁ®ø„Äë${name} - ${author || 'ÂåøÂêç'}`;
                body = `ÊäïÁ®øÁ±ªÂûãÔºöÂ≠ó‰ΩìÊ†∑Âºè\nÂêçÁß∞Ôºö${name}\n‰ΩúËÄÖÔºö${author}\n\nFont-face ‰ª£Á†ÅÔºö\n${css}`;
            }

            const mailtoLink = `mailto:${myEmail}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            window.location.href = mailtoLink;
            setTimeout(() => { showToast('üöÄ Ê≠£Âú®Â∞ùËØïÂî§Ëµ∑ÈÇÆ‰ª∂ÂÆ¢Êà∑Á´Ø...'); }, 200);
        };

        // --- Init ---
        applyBubble();
        applyFont();
        renderBubbleList();
        renderFontList();
        renderPreview();

    })();
</script>
</body>
</html>